<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Gossip - TS、Class and ES5 · 花田半亩</title><meta name="description" content="Gossip - TS、Class and ES5 - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="花田半亩" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="https://github.com/flowerField" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Gossip - TS、Class and ES5</h1><div class="post-info">Mar 24, 2019<span class="post-count"></span> ✧ 字数统计:2.6k(字) &nbsp;&nbsp; ♨︎ 阅读时长:11(分钟)</div><div class="post-content"><div class='tip'>本文讨论Typescript中的Class同ES5构造函数的对应关系，涉及TypeScript的诸多语法、构造函数、面向对象以及原型对象等相关知识点细节，本文只简单对比并不进行深入展开。</div>

<p><a href="">TypeScript</a> 是JavaScript的超集，包含ES5、ES6、ES7+…和扩展。</p>
<p>我们知道在TS中，Class并不是什么新鲜的东西，它的本质其实就是ES那套<code>构造函数·原型对象·实例对象</code>的老古董。在下面的篇幅中，我会简单的对比Class的ES5写法，从最简单到复杂。</p>
<p><span style='border:1px solid #ccc;padding:2px 10px;color:#fff;background:#195'>最简单的类</span></p>
<p>最简单的类，除名字外其它一无所有。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 文件名：01.ts_class_and_es5.ts */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class_test</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过<code>tsc 01.ts_class_and_es5.ts</code>命令对该文件进行编译，得到的是下面的JavaScript代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 文件名：01.ts_class_and_es5.js */</span></span><br><span class="line"><span class="keyword">var</span> Class_test = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Class_test</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> Class_test;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p>从编译后的结果可以看到对应的代码就是个空构造函数，精巧的地方在于<strong>这个函数被放到一个自调用函数中并返回</strong>，这里使用了一个同名的变量来接收内部的构造函数，多么经典的闭包应用啊。</p>
<p><span style='border:1px solid #ccc;padding:2px 10px;color:#fff;background:#195'> + 属性</span></p>
<p>我们尝试在上面代码的基础上，在这个类中加入属性的概念。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class_test</span> </span>&#123;</span><br><span class="line">    <span class="attr">name</span>:string;</span><br><span class="line">    age:number;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name:string,age:number</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">      <span class="built_in">this</span>.age  = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们为Class_test类新添加了属性的概念( 分别是 <code>name</code> 和 <code>age</code> ) , 这里其实如果不想写constructor构造函数的话其实可以给 <code>name</code> 和 <code>age</code> 设置一个初始值也是没问题的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Class_test = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">Class_test</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Class_test;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p>可以发现写法跟ES5构造函数的写法一致，注意Class成员的几个修饰符：<a href="">public</a> <a href="">protected</a> <a href="">private</a> 在ES5代码的结构中没有意义，这里不做额外说明。</p>
<p><span style='border:1px solid #ccc;padding:2px 10px;color:#fff;background:#195'> + 方法(静态)</span></p>
<p>我们在上面代码的基础上再加上方法、静态属性、静态方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 设计类 */</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Class_test</span> </span>&#123;</span><br><span class="line">    <span class="attr">name</span>: string;</span><br><span class="line">    age: number;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: string, age: number</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">      <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    getInfo():<span class="keyword">void</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Name === <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>  Age === <span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 静态属性：构造函数(类)自己的属性，访问示例：类名.静态属性; */</span></span><br><span class="line">    <span class="comment">/* 静态方法：构造函数(类)自己的方法，访问示例：类名.静态方法名称(); */</span></span><br><span class="line">    <span class="keyword">static</span> className: string = <span class="string">&quot;Class_test&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> getClassName():<span class="keyword">void</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;ClassName === &quot;</span>+<span class="built_in">this</span>.className);   <span class="comment">//this=&gt;Class_Test</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 实例化对象 */</span></span><br><span class="line">  <span class="keyword">let</span> c:Class_test = <span class="keyword">new</span> Class_test(<span class="string">&quot;文顶顶&quot;</span>,<span class="number">18</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(c.name,c.age);</span><br><span class="line">  c.getInfo();</span><br><span class="line">  <span class="built_in">console</span>.log(Class_test.className);</span><br><span class="line">  Class_test.getClassName();</span><br></pre></td></tr></table></figure>

<p>我们为代码添加了静态属性 <code>className</code>、静态方法 <code>getClassName()</code> 、实例方法 <code>getInfo()</code>,通过查看对应的ES5代码，我们会发现这也没什么特别的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Class_test = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">Class_test</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">        Class_test.prototype.getInfo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Name === &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;  Age === &quot;</span> + <span class="built_in">this</span>.age);</span><br><span class="line">        &#125;;</span><br><span class="line">        Class_test.getClassName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ClassName === &quot;</span> + <span class="built_in">this</span>.className); <span class="comment">//this=&gt;Class_Test</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">/* 静态属性：构造函数(类)自己的属性，访问示例：类名.静态属性; */</span></span><br><span class="line">        <span class="comment">/* 静态方法：构造函数(类)自己的方法，访问示例：类名.静态方法名称(); */</span></span><br><span class="line">        Class_test.className = <span class="string">&quot;Class_test&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> Class_test;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> c = <span class="keyword">new</span> Class_test(<span class="string">&quot;文顶顶&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(c.name, c.age);           <span class="comment">/* 文顶顶 18 */</span></span><br><span class="line">    c.getInfo();                          <span class="comment">/* Name === 文顶顶  Age === 18 */</span></span><br><span class="line">    <span class="built_in">console</span>.log(Class_test.className);    <span class="comment">/* Class_test */</span></span><br><span class="line">    Class_test.getClassName();            <span class="comment">/* ClassName === Class_test */</span></span><br></pre></td></tr></table></figure>
<p>关键在于搞清楚<strong>成员</strong>、<strong>原型成员</strong>、<strong>静态成员</strong>、<strong>实例成员</strong>、<strong>构造函数</strong>、<strong>原型对象</strong>以及<strong>实例化</strong>的关系。</p>
<p><span style='border:1px solid #ccc;padding:2px 10px;color:#fff;background:#195'> + 继承 </span></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 设计类(父类) */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class_super</span> </span>&#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  age: number;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name: string, age: number</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line">  getInfo():<span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Name === <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>  Age === <span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> className: string = <span class="string">&quot;Class_test&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> getClassName():<span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;ClassName === &quot;</span>+<span class="built_in">this</span>.className);   <span class="comment">//this=&gt;Class_Test</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设计类(子类) */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class_child</span> <span class="keyword">extends</span> <span class="title">Class_super</span></span>&#123;</span><br><span class="line">  <span class="attr">money</span>:number;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name: string, age: number,money:number</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name,age);</span><br><span class="line">    <span class="built_in">this</span>.money = money;</span><br><span class="line">  &#125;</span><br><span class="line">  getMoney():<span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Money === <span class="subst">$&#123;<span class="built_in">this</span>.money&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> child_static_func():<span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;测试该方法能否被Class_super方法调用？No&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 实例化(对象) */</span></span><br><span class="line"><span class="keyword">let</span> child:Class_child = <span class="keyword">new</span> Class_child(<span class="string">&quot;zs&quot;</span>,<span class="number">19</span>,<span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child,child.name,child.age,child.money);</span><br><span class="line">child.getInfo();</span><br><span class="line">child.getMoney();</span><br><span class="line"><span class="built_in">console</span>.log(Class_child.className);</span><br><span class="line">Class_child.getClassName();</span><br><span class="line">Class_child.child_static_func();</span><br><span class="line"><span class="comment">// Class_super.child_static_func();   错误的示范</span></span><br></pre></td></tr></table></figure>
<p>如果我们实现了类的继承，那么问题就会变得复杂得多，至少看起来如此。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> __extends = (<span class="built_in">this</span> &amp;&amp; <span class="built_in">this</span>.__extends) || (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> extendStatics = <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123;</span><br><span class="line">        extendStatics = <span class="built_in">Object</span>.setPrototypeOf ||</span><br><span class="line">            (&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123; d.__proto__ = b; &#125;) </span><br><span class="line">            || <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) <span class="keyword">if</span> (b.hasOwnProperty(p)) d[p] = b[p]&#125;;</span><br><span class="line">        <span class="keyword">return</span> extendStatics(d, b);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">d, b</span>) </span>&#123;</span><br><span class="line">        extendStatics(d, b);</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__</span>(<span class="params"></span>) </span>&#123; <span class="built_in">this</span>.constructor = d; &#125;</span><br><span class="line">    d.prototype = b === <span class="literal">null</span> ? <span class="built_in">Object</span>.create(b) : (__.prototype = b.prototype, <span class="keyword">new</span> __());</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设计类(父类) */</span></span><br><span class="line"><span class="keyword">var</span> Class_super = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Class_super</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    Class_super.prototype.getInfo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Name === &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;  Age === &quot;</span> + <span class="built_in">this</span>.age);</span><br><span class="line">    &#125;;</span><br><span class="line">    Class_super.getClassName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;ClassName === &quot;</span> + <span class="built_in">this</span>.className); <span class="comment">//this=&gt;Class_Test</span></span><br><span class="line">    &#125;;</span><br><span class="line">    Class_super.className = <span class="string">&quot;Class_test&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> Class_super;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="comment">/* 设计类(子类) */</span></span><br><span class="line"><span class="keyword">var</span> Class_child = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params">_super</span>) </span>&#123;</span><br><span class="line">    __extends(Class_child, _super);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Class_child</span>(<span class="params">name, age, money</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _this = _super.call(<span class="built_in">this</span>, name, age) || <span class="built_in">this</span>;</span><br><span class="line">        _this.money = money;</span><br><span class="line">        <span class="keyword">return</span> _this;</span><br><span class="line">    &#125;</span><br><span class="line">    Class_child.prototype.getMoney = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Money === &quot;</span> + <span class="built_in">this</span>.money);</span><br><span class="line">    &#125;;</span><br><span class="line">    Class_child.child_static_func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;测试该方法能否被Class_super方法调用？No&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> Class_child;</span><br><span class="line">&#125;(Class_super));</span><br><span class="line"><span class="comment">/* 实例化(对象) */</span></span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Class_child(<span class="string">&quot;zs&quot;</span>, <span class="number">19</span>, <span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child, child.name, child.age, child.money);   </span><br><span class="line"><span class="comment">/* Class_child &#123; name: &#x27;zs&#x27;, age: 19, money: 100 &#125; &#x27;zs&#x27; 19 100 */</span></span><br><span class="line">child.getInfo();                    <span class="comment">/* Name === zs  Age === 19 */</span></span><br><span class="line">child.getMoney();                   <span class="comment">/* Money === 100 */</span></span><br><span class="line"><span class="built_in">console</span>.log(Class_child.className); <span class="comment">/* Class_test */</span></span><br><span class="line">Class_child.getClassName();         <span class="comment">/* ClassName === Class_test */</span></span><br><span class="line">Class_child.child_static_func();    <span class="comment">/* 测试该方法能否被Class_super方法调用？No */</span></span><br><span class="line"><span class="comment">// Class_super.child_static_func();   错误的示范</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>蒽，是的。看上去，TS ( ES6 ) 中感觉Class继承的实现稍显复杂。接下来，我们试着挑出关键的部分，并把比较重要(表面感觉不太看得懂)的那部分代码加上些注释。</p>
<p><strong>关键 ①</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = _super.call(<span class="built_in">this</span>, name, age) || <span class="built_in">this</span>;</span><br></pre></td></tr></table></figure>
<p>这行代码的目的是获取父类的实例成员，具体采用的技术手段是通过借用构造函数调用( <a href="">在子构造函数中以call方法来调用父构造函数，并绑定this </a>)的方式来获取。此处，拿到的是<code>name</code> <code>age</code>两个属性(当我们通过子类来实例化创建对象的时候，得到的实例化对象中因此拥有了<code>name</code> 和 <code>age</code> 属性)。</p>
<p><strong>关键 ②</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__extends(Class_child, _super);</span><br></pre></td></tr></table></figure>
<p>这行代码是一个函数调用，其中__extends是函数名称，而Class_child, _super是传递给函数的具体实参。<br>该函数的作用是，通过特定的方式来获取父类(构造函数)的静态成员(包括静态属性以及静态方法)并让实例对象可以通过原型链来访问父类原型对象上面的成员(属性和方法)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* @Description: __extends主要用于处理(静态成员)的继承</span></span><br><span class="line"><span class="comment"> * @return: 函数形态 function f(_child,_super)&#123;&#125; */</span></span><br><span class="line"><span class="keyword">var</span> __extends = (<span class="built_in">this</span> &amp;&amp; <span class="built_in">this</span>.__extends) || (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">/* @Description: extendStatics用于扩展静态成员(静态属性和静态方法)</span></span><br><span class="line"><span class="comment"> * param __child  子类(Class_child)</span></span><br><span class="line"><span class="comment"> * param __super  父类(Class_super)*/</span></span><br><span class="line"><span class="keyword">var</span> extendStatics = <span class="function"><span class="keyword">function</span>(<span class="params">__child, __super</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* 1.确定函数 */</span></span><br><span class="line">    <span class="comment">/* extendStatics变量的值总是为一个函数，该函数的目的是_super的属性和方法(静态)*/</span></span><br><span class="line">    <span class="comment">/* 核心策略 */</span></span><br><span class="line">    <span class="comment">/* ① 尝试直接使用 Object.setPrototypeOf函数 类似于__child.__proto__ = __super */</span></span><br><span class="line">    <span class="comment">/* ② 直接通过__child.__proto__ = __super来设置 */</span></span><br><span class="line">    <span class="comment">/* ③ 通过遍历的方式来拷贝_super对象的实例成员 */</span></span><br><span class="line">    extendStatics = <span class="built_in">Object</span>.setPrototypeOf </span><br><span class="line">    ||(&#123; <span class="attr">__proto__</span>: [] &#125; <span class="keyword">instanceof</span> <span class="built_in">Array</span> </span><br><span class="line">      &amp;&amp; <span class="function"><span class="keyword">function</span>(<span class="params">__child, __super</span>) </span>&#123;</span><br><span class="line">         __child.__proto__ = __super; </span><br><span class="line">         &#125;) </span><br><span class="line">    ||<span class="function"><span class="keyword">function</span>(<span class="params">d, b</span>) </span>&#123; </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b) &#123; </span><br><span class="line">        <span class="keyword">if</span> (b.hasOwnProperty(p)) d[p] = b[p]; &#125; </span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="comment">/* 2.调用函数(完成继承) */</span></span><br><span class="line">    <span class="keyword">return</span> extendStatics(__child, __super);</span><br><span class="line">&#125;;</span><br><span class="line"> <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">_child, _super</span>) </span>&#123;</span><br><span class="line">     <span class="comment">/* [1] 完成对父类(构造函数)静态成员(属性+方法)的拷贝工作 */</span></span><br><span class="line">     extendStatics(_child, _super);</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* [2] 完成对父类(构造函数)原型成员(主要是方法)的原型链继承 */</span></span><br><span class="line">     <span class="comment">/* 内部的this取决于__()函数如何调用，使用new调用则this指向的是内部新创建的实例对象 */</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">__</span>(<span class="params"></span>) </span>&#123; <span class="built_in">this</span>.constructor = _child; &#125; </span><br><span class="line"></span><br><span class="line">     <span class="comment">/* 如果_spuer为null,那么就创建一个新对象*/</span></span><br><span class="line">     <span class="comment">/* 设置该对象的原型对象为_super[let o = &#123;&#125;; o.__prototype = _super] */</span> </span><br><span class="line">     <span class="comment">/* 并把最终结果赋值给_child.prototype, 否则就间接通过__()这个函数来设置原型对象*/</span></span><br><span class="line">     <span class="comment">/* 并创建实例化对象，并设置 _child.prototype = new __() */</span></span><br><span class="line">     _child.prototype = </span><br><span class="line">          _super === <span class="literal">null</span> ? </span><br><span class="line">          <span class="built_in">Object</span>.create(_super) : </span><br><span class="line">          (__.prototype = _super.prototype, <span class="keyword">new</span> __());</span><br><span class="line"> &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>我在代码中穿插并加上了一些说明性的注释 ，看上去似乎比较复杂，稍微总结下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__extends() 函数做了两件事情：</span><br><span class="line">  [1] 完成对父类(构造函数)静态成员(属性+方法)的拷贝工作</span><br><span class="line">  [2] 完成对父类(构造函数)原型成员(主要是方法)的原型链继承</span><br><span class="line">如何做的？</span><br><span class="line">  [1] child.__proto__ = super  </span><br><span class="line">  [2] child.prototype = super.prototype; + 解决共享问题(中间加了间隔层)</span><br></pre></td></tr></table></figure>
<img src='../../../../src/ts_class.png'>

<p><span style='border:1px solid #ccc;padding:2px 10px;color:#fff;background:#195'> + Interface </span></p>
<p>接口( <a href="">interface </a> )是 typescript 中的重要概念，而且接口也能继承且可以约束类，因此这里简单的比较下，下面给出示例代码以及对应的JavaScript代码。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1.定义接口(父) */</span></span><br><span class="line">  <span class="keyword">interface</span> Test_Class_Super_Interface &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    age: <span class="built_in">number</span>;</span><br><span class="line">    getName: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    getAge: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 2.定义接口(子) */</span></span><br><span class="line">  <span class="keyword">interface</span> Test_Class_Child_Interface <span class="keyword">extends</span> Test_Class_Super_Interface&#123;</span><br><span class="line">    <span class="attr">id</span>:<span class="built_in">number</span>;</span><br><span class="line">    getId:<span class="function">()=&gt;</span><span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 3.设计类：该类实现指定的接口 */</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Test_Class</span> <span class="title">implements</span> <span class="title">Test_Class_Child_Interface</span> </span>&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    age: <span class="built_in">number</span>;</span><br><span class="line">    getName(): <span class="built_in">void</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;getName() &quot;</span> + <span class="built_in">this</span>.name)</span><br><span class="line">    &#125;;</span><br><span class="line">    getAge(): <span class="built_in">void</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;getAge() &quot;</span> + <span class="built_in">this</span>.age)</span><br><span class="line">    &#125;;</span><br><span class="line">    getId():<span class="built_in">void</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">      <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 4.创建实例化对象 */</span></span><br><span class="line">  <span class="keyword">let</span> instance: Test_Class = <span class="keyword">new</span> Test_Class(<span class="string">&quot;ls&quot;</span>, <span class="number">18</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(instance);</span><br></pre></td></tr></table></figure>
<p>上面代码设计了两个接口，分别是<code>Test_Class_Super_Interface</code> 和 <code>Test_Class_Child_Interface</code>,它们是继承关系，<a href="">Test_Class</a> 类实现了<code>Test_Class_Child_Interface</code>接口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Test_Class = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">Test_Class</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.id = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">        Test_Class.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;getName() &quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">        &#125;;;</span><br><span class="line">        Test_Class.prototype.getAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;getAge() &quot;</span> + <span class="built_in">this</span>.age);</span><br><span class="line">        &#125;;;</span><br><span class="line">        Test_Class.prototype.getId = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.id);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> Test_Class;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">var</span> instance = <span class="keyword">new</span> Test_Class(<span class="string">&quot;ls&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(instance);</span><br></pre></td></tr></table></figure>
<p>我们发现转换后 JavaScript版本的代码里面好像没有任何与接口相关的信息，<strong>接口是 typescript 中特有的<code>类型</code>, 在编译后会自动消失。</strong></p>
<img src='../../../../z.png' width="200px">

<ul>
<li>Posted by 博客园·<a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a> | <a target="_blank" rel="noopener" href="http://wendingding.com/">花田半亩</a></li>
<li>联系作者 简书·<a target="_blank" rel="noopener" href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2019/03/28/Gossip%20-%20Throttle%20And%20Debounce%20/" class="prev">上一篇</a><a href="/2019/03/01/%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87-webpack%E6%89%93%E5%8C%85%E5%87%BA%E9%94%99/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 422.4k (字)</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>