<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> jQuery系列 [10]-jQuery框架源码解读[结构] · 花田半亩</title><meta name="description" content="jQuery系列 [10]-jQuery框架源码解读[结构] - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="花田半亩" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="https://github.com/flowerField" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">jQuery系列 [10]-jQuery框架源码解读[结构]</h1><div class="post-info">Sep 3, 2017<span class="post-count"></span> ✧ 字数统计:3.2k(字) &nbsp;&nbsp; ♨︎ 阅读时长:14(分钟)</div><div class="post-content"><blockquote>
<p>这篇文章将主要介绍jQuery框架的前面几百行代码并说明jQuery框架的整体结构。</p>
</blockquote>
<h3 id="1-0-源码解读"><a href="#1-0-源码解读" class="headerlink" title="1.0 源码解读"></a>1.0 源码解读</h3><p>这里先简单贴出jQuery框架3.3.1版本中的前600行代码，其它和整体结构无关的部分省略了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> * jQuery JavaScript Library v3<span class="number">.3</span><span class="number">.1</span></span><br><span class="line"> * https:<span class="comment">//jquery.com/                  官网地址</span></span><br><span class="line"> *</span><br><span class="line"> * Includes Sizzle.js</span><br><span class="line"> * https:<span class="comment">//sizzlejs.com/                核心选择器</span></span><br><span class="line"> *</span><br><span class="line"> * Copyright JS Foundation and other contributors</span><br><span class="line"> * Released under the MIT license	    开源协议</span><br><span class="line"> * https:<span class="comment">//jquery.org/license           开源协议地址</span></span><br><span class="line"> *</span><br><span class="line"> * <span class="built_in">Date</span>: <span class="number">2018</span>-<span class="number">01</span>-20T17:24Z			    更新(发布)时间</span><br><span class="line"></span><br><span class="line"><span class="comment">//jQuery的外城结构是一个闭包(即时调用函数)</span></span><br><span class="line"><span class="comment">//整体结构可以抽象为(fn)(....)</span></span><br><span class="line">( <span class="function"><span class="keyword">function</span>(<span class="params"> <span class="built_in">global</span>, factory </span>) </span>&#123;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">	&quot;use strict&quot;</span>; 	<span class="comment">//开启严格模式</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断的当前的环境是否是CommonJs</span></span><br><span class="line">	<span class="comment">//说明：CommJs 环境中会有一个 module 对象，这个对象上会有一个 exports 对象</span></span><br><span class="line">	<span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span>.exports === <span class="string">&quot;object&quot;</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// For CommonJS and CommonJS-like environments where a proper `window`</span></span><br><span class="line">		<span class="comment">// is present, execute the factory and get jQuery.</span></span><br><span class="line">		<span class="comment">// For environments that do not have a `window` with a `document`</span></span><br><span class="line">		<span class="comment">// (such as Node.js), expose a factory as module.exports.</span></span><br><span class="line">		<span class="comment">// This accentuates the need for the creation of a real `window`.</span></span><br><span class="line">		<span class="comment">// e.g. var jQuery = require(&quot;jquery&quot;)(window);</span></span><br><span class="line">		<span class="comment">// See ticket #14549 for more info.</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//如果在 CommonJs 环境下，那么将 jQuery 对象挂载到 module.exports 对象</span></span><br><span class="line">		<span class="comment">//factory函数的第二个参数传递为true,表示将不会在window上注册jQuery对象</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//因为可能运行在非浏览器下，所有对global.document进行检查</span></span><br><span class="line">		<span class="comment">//如果global.document有值，那么调用factory( global, true )得到结果赋值给module.exports</span></span><br><span class="line">		<span class="comment">//如果global.document没有值(在非浏览器环境下)，我们没有window对象，那么就需要自己创建了一个模拟浏览器的环境</span></span><br><span class="line">		<span class="comment">//传入自己的 window 对象，这种情况下 jQuery 对象将绑定到你传入的这个特殊的 window 对象上</span></span><br><span class="line">		<span class="built_in">module</span>.exports = <span class="built_in">global</span>.document ?</span><br><span class="line">			factory( <span class="built_in">global</span>, <span class="literal">true</span> ) :</span><br><span class="line">			<span class="function"><span class="keyword">function</span>(<span class="params"> w </span>) </span>&#123;</span><br><span class="line">				<span class="keyword">if</span> ( !w.document ) &#123;</span><br><span class="line">					<span class="comment">//如果没有document,那么就抛出错误信息</span></span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( <span class="string">&quot;jQuery requires a window with a document&quot;</span> );</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> factory( w );</span><br><span class="line">			&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//如果不是在 CommonJs 环境下，直接执行工厂函数</span></span><br><span class="line">        <span class="comment">//调用函数的时候传递一个参数(window|this),第二个参数没有传值，默认为undefined</span></span><br><span class="line">		factory( <span class="built_in">global</span> );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Pass this if window is not defined yet</span></span><br><span class="line">    <span class="comment">//实参说明：第一个参数(global)的值为window 或者 是当前上下文this,第二个参数为函数</span></span><br><span class="line">&#125; )( <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span> ? <span class="built_in">window</span> : <span class="built_in">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> <span class="built_in">window</span>, noGlobal </span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Edge &lt;= 12 - 13+, Firefox &lt;=18 - 45+, IE 10 - 11, Safari 5.1 - 9+, iOS 6 - 9.1</span></span><br><span class="line"><span class="comment">// throw exceptions when non-strict code (e.g., ASP.NET 4.5) accesses strict mode</span></span><br><span class="line"><span class="comment">// arguments.callee.caller (trac-13335). But as of jQuery 3.0 (2016), strict mode should be common</span></span><br><span class="line"><span class="comment">// enough that all such attempts are guarded in a try block.</span></span><br><span class="line"><span class="comment">//开启严格模式</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明变量</span></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取document文件</span></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">document</span> = <span class="built_in">window</span>.document;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存Object对象上获取原型对象的方法</span></span><br><span class="line"><span class="keyword">var</span> getProto = <span class="built_in">Object</span>.getPrototypeOf;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存数组中截取元素的方法</span></span><br><span class="line"><span class="keyword">var</span> slice = arr.slice;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存数组中合并数组的方法</span></span><br><span class="line"><span class="keyword">var</span> concat = arr.concat;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存数组中添加元素的方法</span></span><br><span class="line"><span class="keyword">var</span> push = arr.push;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存数组中返回元素索引的方法</span></span><br><span class="line"><span class="keyword">var</span> indexOf = arr.indexOf;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化空的对象</span></span><br><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存&#123;&#125;.toString方法,其实是Object.prototype.toString方法</span></span><br><span class="line"><span class="comment">//该方法用于获取指定对象的类型和真实构造函数 ex: [object String]</span></span><br><span class="line"><span class="keyword">var</span> toString = class2type.toString;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存检查是否是实例成员的方法</span></span><br><span class="line"><span class="keyword">var</span> hasOwn = class2type.hasOwnProperty;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存 Object.prototype.hasOwnProperty.toString方法</span></span><br><span class="line"><span class="keyword">var</span> fnToString = hasOwn.toString;</span><br><span class="line"><span class="comment">//保存 Object.prototype.hasOwnProperty.toString.call(Object) 方法</span></span><br><span class="line"><span class="comment">//	==&gt; &quot;function Object() &#123; [native code] &#125;&quot;</span></span><br><span class="line"><span class="keyword">var</span> ObjectFunctionString = fnToString.call( <span class="built_in">Object</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化空的对象</span></span><br><span class="line"><span class="keyword">var</span> support = &#123;&#125;;</span><br><span class="line"><span class="comment">// 工具函数：检查传入的对象是否是函数类型的</span></span><br><span class="line"><span class="keyword">var</span> isFunction = <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Support: Chrome &lt;=57, Firefox &lt;=52</span></span><br><span class="line">	  <span class="comment">//浏览器的支持情况</span></span><br><span class="line">      <span class="comment">// In some browsers, typeof returns &quot;function&quot; for HTML &lt;object&gt; elements</span></span><br><span class="line">	  <span class="comment">// 在很多的浏览器中对HTML对象节点执行typeof会返回 function</span></span><br><span class="line">      <span class="comment">// (i.e., `typeof document.createElement( &quot;object&quot; ) === &quot;function&quot;`).</span></span><br><span class="line">	  <span class="comment">// 在ie中typeof document.createElement( &quot;object&quot; )的结果为function</span></span><br><span class="line">      <span class="comment">// We don&#x27;t want to classify *any* DOM node as a function.</span></span><br><span class="line">	  <span class="comment">// 在检查函数的时候排除任何的DOM节点</span></span><br><span class="line">	  <span class="comment">// 注：DOM节点均拥有nodeType属性，属性值为number类型，根据具体的数值不同来进行区分 1为元素节点 2为属性节点</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">&quot;function&quot;</span> &amp;&amp; <span class="keyword">typeof</span> obj.nodeType !== <span class="string">&quot;number&quot;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//工具函数：检查传入的参数是否是window</span></span><br><span class="line"><span class="keyword">var</span> isWindow = <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">		<span class="comment">//检查window的方式  window = window.window 即window对象本身拥有window属性来标名自己是window</span></span><br><span class="line">		<span class="comment">//null不能拥有任何的属性，排除null</span></span><br><span class="line">		<span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj === obj.window;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存script属性的字面量对象:类型|资源|noModule</span></span><br><span class="line"><span class="keyword">var</span> preservedScriptAttributes = &#123;</span><br><span class="line">		<span class="attr">type</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">src</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">noModule</span>: <span class="literal">true</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该方法作为 $.globalEval();方法的内部实现,作用类似于js原生的eval方法</span></span><br><span class="line"><span class="comment">// $.globalEval( &quot;var a = 1;&quot; );方法其实就是调用 DOMEval(&quot;var a = 1;&quot;);</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DOMEval</span>(<span class="params"> code, doc, node </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	     <span class="comment">//如果doc没有值,那么初始化为document</span></span><br><span class="line">		doc = doc || <span class="built_in">document</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建空的script标签</span></span><br><span class="line">		<span class="keyword">var</span> i,</span><br><span class="line">			script = doc.createElement( <span class="string">&quot;script&quot;</span> );</span><br><span class="line">		<span class="comment">//设置script标签的文本内容</span></span><br><span class="line">		script.text = code;</span><br><span class="line">		<span class="keyword">if</span> ( node ) &#123;</span><br><span class="line">			<span class="comment">//循环preservedScriptAttributes对象</span></span><br><span class="line">			<span class="comment">//把node节点中的type &amp;&amp; src &amp;&amp; noModule拷贝给script标签</span></span><br><span class="line">			<span class="keyword">for</span> ( i <span class="keyword">in</span> preservedScriptAttributes ) &#123;</span><br><span class="line">				<span class="keyword">if</span> ( node[ i ] ) &#123;</span><br><span class="line">					script[ i ] = node[ i ];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//doc.head 表示访问页面中的header头部标签</span></span><br><span class="line">		<span class="comment">//把先创建的script标签插入到页面然后删除掉</span></span><br><span class="line">		doc.head.appendChild( script ).parentNode.removeChild( script );</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//	获取参数对应的数据类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toType</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 如果参数是null,那么就返回&quot;null&quot;</span></span><br><span class="line">	<span class="keyword">if</span> ( obj == <span class="literal">null</span> ) &#123;</span><br><span class="line">		<span class="keyword">return</span> obj + <span class="string">&quot;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Support: Android &lt;=2.3 only (functionish RegExp)</span></span><br><span class="line">	<span class="comment">// 如果typeof的结果为object 或者是function 那么就通过class2type[ toString.call( obj ) ]方法计算</span></span><br><span class="line">	<span class="comment">// class2type[ toString.call( obj ) ] 其实就是Object.prototype.toString.call(obj) 形式</span></span><br><span class="line">	<span class="comment">// 如果toString方法计算的结果为false,那么就返回object,否则返回typeof obj的值</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> obj === <span class="string">&quot;function&quot;</span> ?</span><br><span class="line">		class2type[ toString.call( obj ) ] || <span class="string">&quot;object&quot;</span> :</span><br><span class="line">		<span class="keyword">typeof</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* global Symbol */</span></span><br><span class="line"><span class="comment">// Defining this global in .eslintrc.json would create a danger of using the global</span></span><br><span class="line"><span class="comment">// unguarded in another place, it seems safer to define global only for this module</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">	<span class="comment">// 当前版本</span></span><br><span class="line">	version = <span class="string">&quot;3.3.1&quot;</span>,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Define a local copy of jQuery 定义jQuery的本地副本</span></span><br><span class="line">	<span class="comment">// jQuery工厂函数的定义(声明)</span></span><br><span class="line">	<span class="comment">// 参数1 ： 选择器</span></span><br><span class="line">	<span class="comment">// 参数2 :  上下文对象</span></span><br><span class="line">	jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// The jQuery object is actually just the init constructor &#x27;enhanced&#x27;</span></span><br><span class="line">		<span class="comment">// Need init if jQuery is called (just allow error to be thrown if not included)</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// jQuery.fn,init 作为构造函数，这里返回的其实是jQuery.fn.init构造函数的实例化对象</span></span><br><span class="line">		<span class="comment">// 调用jQuery函数的时候其实是以构造函数的方式调用 xxx...init函数</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Support: Android &lt;=4.0 only</span></span><br><span class="line">	<span class="comment">// Make sure we trim BOM and NBSP</span></span><br><span class="line">	<span class="comment">// 确保对BOM和NBSP的处理,清除字符串开始和结尾的一个或多个空格的正则表达式</span></span><br><span class="line">	rtrim = <span class="regexp">/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置jQuery的原型对象，并把原型对象赋值给jQuery.fn</span></span><br><span class="line">jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//这里列出了一部分jQuery原型成员（属性和方法）</span></span><br><span class="line">	<span class="comment">//所有的jQuery实例对象都能够访问这些属性和方法</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// The current version of jQuery being used</span></span><br><span class="line">	<span class="comment">//当前正在使用的jQuery版本信息</span></span><br><span class="line">	<span class="attr">jquery</span>: version,</span><br><span class="line">	<span class="comment">//构造器属性 ---&gt; jQuery</span></span><br><span class="line">	<span class="attr">constructor</span>: jQuery,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The default length of a jQuery object is 0</span></span><br><span class="line">	<span class="comment">//jQuery实例对象中数据的个数，默认长度为0</span></span><br><span class="line">	<span class="attr">length</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 把jQuery实例对象转换为数组类型的方法</span></span><br><span class="line">	<span class="attr">toArray</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//其实调用的是Array.prototype.slice.call(this) 方法 相当于this.slice()</span></span><br><span class="line">		<span class="comment">//在数组的slice方法中，如果不接受参数则表示截取所有的元素保存到一个新的数组中返回</span></span><br><span class="line">		<span class="keyword">return</span> slice.call( <span class="built_in">this</span> );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get the Nth element in the matched element set OR</span></span><br><span class="line">	<span class="comment">// Get the whole matched element set as a clean array</span></span><br><span class="line">	<span class="comment">// 获取jQ对象中指定索引对应的数据(通常为DOM节点)</span></span><br><span class="line">	<span class="attr">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Return all the elements in a clean array</span></span><br><span class="line">		<span class="comment">//如果没有传递参数，那么等价于调用了toArray方法</span></span><br><span class="line">		<span class="comment">//把当前jQ对象中所有的value值保存到数组中返回</span></span><br><span class="line">		<span class="keyword">if</span> ( num == <span class="literal">null</span> ) &#123;</span><br><span class="line">			<span class="keyword">return</span> slice.call( <span class="built_in">this</span> );</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Return just the one element from the set</span></span><br><span class="line">		<span class="comment">// 区分索引值的情况</span></span><br><span class="line">		<span class="comment">// 如果索引值为负数那么 返回this[index + this.length]</span></span><br><span class="line">		<span class="comment">// 如果索引值&gt; = 0     返回thus[index]</span></span><br><span class="line">		<span class="keyword">return</span> num &lt; <span class="number">0</span> ? <span class="built_in">this</span>[ num + <span class="built_in">this</span>.length ] : <span class="built_in">this</span>[ num ];</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Take an array of elements and push it onto the stack</span></span><br><span class="line">	<span class="comment">// (returning the new matched element set)</span></span><br><span class="line">	<span class="comment">// 维护堆栈集合 把传入的数据包裹成一个新的jQ对象，然后更新prevObject的值为上一个(this)对象</span></span><br><span class="line">	<span class="attr">pushStack</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Build a new jQuery matched element set</span></span><br><span class="line">		<span class="comment">// merge方法用于合并两个数组</span></span><br><span class="line">		<span class="comment">// this.constructor() 其实就是this.jQuery(); 得到的是一个空的jQ实例对象</span></span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">		<span class="keyword">var</span> ret = jQuery.merge( <span class="built_in">this</span>.constructor(), elems );</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Add the old object onto the stack (as a reference)</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//prevObject属性用于维护和记录前一个操作的jQ实例对象</span></span><br><span class="line">		<span class="comment">//把当前对象设置为ret的prevObject属性，并返回</span></span><br><span class="line">		ret.prevObject = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Return the newly-formed element set</span></span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Execute a callback for every element in the matched set.</span></span><br><span class="line">	<span class="comment">//迭代jQuery实例对象的方法，该方法内部调用jQuery.each方法实现</span></span><br><span class="line">	<span class="attr">each</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> jQuery.each( <span class="built_in">this</span>, callback );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 数组映射方法，对jQuery.map方法做了额外的包装</span></span><br><span class="line">	<span class="attr">map</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.pushStack( jQuery.map( <span class="built_in">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">			<span class="comment">//使用当前的元素来调用callback方法,绑定this</span></span><br><span class="line">			<span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">		&#125; ) );</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 截取对象中指定的键值对(元素)</span></span><br><span class="line">	<span class="comment">//因为slice方法调用后返回的是一个新的对象集合，所以需要调用pushStack方法维护prevObject堆栈</span></span><br><span class="line">	<span class="attr">slice</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//核心实现：this =&gt; Array.prototype.slice(arguments) || this =&gt; [].slice(arguments)</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.pushStack( slice.apply( <span class="built_in">this</span>, <span class="built_in">arguments</span> ) );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取jQuery实例对象中的第一个元素(第一个键值对中的value值，其实就是第一个DOM标签)包裹为jQuery对象返回</span></span><br><span class="line">	<span class="comment">//内部通过调用jQuery.eq方法实现，</span></span><br><span class="line">	<span class="attr">first</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.eq( <span class="number">0</span> );</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//获取jQuery实例对象中的最后一个元素</span></span><br><span class="line">	<span class="comment">//同first方法一致，eq方法传递-1表示倒着数，即倒数第一个(最后一个)元素</span></span><br><span class="line">	<span class="attr">last</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.eq( -<span class="number">1</span> );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取jQuery实例对象中指定索引对应的元素，拿到元素后包装为jQuery实例对象返回</span></span><br><span class="line">	<span class="comment">//该方法的参数支持正整数或者是负数</span></span><br><span class="line">	<span class="attr">eq</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> len = <span class="built_in">this</span>.length,</span><br><span class="line">			j = +i + ( i &lt; <span class="number">0</span> ? len : <span class="number">0</span> );</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.pushStack( j &gt;= <span class="number">0</span> &amp;&amp; j &lt; len ? [ <span class="built_in">this</span>[ j ] ] : [] );</span><br><span class="line"></span><br><span class="line">		<span class="comment">//自己写的另外一种实现方案(在判断的时候需要考虑到越界的问题)</span></span><br><span class="line">		<span class="comment">// var len = this.length;</span></span><br><span class="line">		<span class="comment">// var arrM = [];</span></span><br><span class="line">		<span class="comment">// if (i &gt;= 0 &amp;&amp; i &lt; len)</span></span><br><span class="line">		<span class="comment">// &#123;</span></span><br><span class="line">		<span class="comment">// 		arrM.push(this[i])</span></span><br><span class="line">		<span class="comment">// &#125;</span></span><br><span class="line">		<span class="comment">// else if(i &lt; 0 &amp;&amp; (-i &lt; len) )</span></span><br><span class="line">		<span class="comment">// &#123;</span></span><br><span class="line">		<span class="comment">// 		arrM.push(this[i + len])</span></span><br><span class="line">		<span class="comment">// &#125;</span></span><br><span class="line">		<span class="comment">// return this.pushStack(arrM)</span></span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//返回前一个操作的jQuery实例对象</span></span><br><span class="line">	<span class="attr">end</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//检查prevObject的属性值，如果优质那么就返回prevObject否则返回空的jQuery实例对象</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.prevObject || <span class="built_in">this</span>.constructor();</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// For internal use only.</span></span><br><span class="line">	<span class="comment">// 仅供内部使用的方法</span></span><br><span class="line">	<span class="comment">// Behaves like an Array&#x27;s method, not like a jQuery method.</span></span><br><span class="line">	<span class="comment">// 这些方法的表现和数组一致，不完全像jQuery风格的方法</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//往jQuery实例对象中添加数据</span></span><br><span class="line">	<span class="attr">push</span>: push,</span><br><span class="line">	<span class="comment">//排序的方法</span></span><br><span class="line">	<span class="attr">sort</span>: arr.sort,</span><br><span class="line">	<span class="comment">//添加|删除的方法，其实就是数组中的splice方法</span></span><br><span class="line">	<span class="attr">splice</span>: arr.splice</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//......</span></span><br><span class="line"><span class="comment">// 设置jQuery.prototype.init方法</span></span><br><span class="line">init = jQuery.fn.init = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context, root </span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Give the init function the jQuery prototype for later instantiation</span></span><br><span class="line">/  让jQuery.prototype.init方法的原型对象指向jQuery原型对象</span><br><span class="line"><span class="comment">// (正因如此$(&quot;xx&quot;)得到的jQ实例对象才能访问jQuery原型对象上面的方法)</span></span><br><span class="line">init.prototype = jQuery.fn;</span><br><span class="line"><span class="comment">//.....</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">&#125; );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-0-框架的整体结构"><a href="#2-0-框架的整体结构" class="headerlink" title="2.0 框架的整体结构"></a>2.0 框架的整体结构</h3><p>下面给出简化后jQuery框架的整体结构。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//01 立即调用函数(闭包)</span><br><span class="line">(function (window) &#123;</span><br><span class="line"></span><br><span class="line">    //02 提供工厂函数</span><br><span class="line">    var jQuery = function (selector) &#123;</span><br><span class="line">        return new jQuery.fn.init(selector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //03 设置原型对象</span><br><span class="line">    jQuery.prototype = &#123;</span><br><span class="line">        constructor:jQuery,</span><br><span class="line">        init:function (selector) &#123;</span><br><span class="line">            //初始化处理...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //动态的添加fn属性</span><br><span class="line">    jQuery.fn = jQuery.prototype;</span><br><span class="line">    </span><br><span class="line">    //04 原型对象赋值</span><br><span class="line">    jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line"></span><br><span class="line">    //........</span><br><span class="line">    </span><br><span class="line">    //05 把jQuery和$暴露出来</span><br><span class="line">    window.$ = window.jQuery = jQuery;</span><br><span class="line"></span><br><span class="line">&#125;)(window);</span><br></pre></td></tr></table></figure>

<img src='../../../../src/jq_02.png'>

<p><strong>jQuery框架整体结构总结</strong></p>
<blockquote>
<p>❏ &nbsp;&nbsp;jQuery本身是闭包中的一个函数，该函数作工厂函数用。<br>❏ &nbsp;&nbsp;jQuery所有的代码都被放在一个即时调用函数中(闭包)，拥有独立和安全的作用域。<br>❏ &nbsp;&nbsp;jQuery方法在调用的时候，获取的实例对象其本质上是<code>jQuery.fn.init</code>构造函数实例化的。<br>❏ &nbsp;&nbsp;jQuery函数调用的时候，参数实际上都传递给了<code>init</code>函数，<code>init</code>函数才是真正的入口函数。<br>❏ &nbsp;&nbsp;为了让实例对象访问jQuery原型对象的成员，设置了<code>jQuery.fn.init</code>和<code>jQuery原型对象</code>共享。<br>❏ &nbsp;&nbsp;jQuery通过把自身赋值给window成为全局对象的属性来实现框架外的访问(<code>$ 和 jQuery</code>访问)。</p>
</blockquote>
<img src='../../../../z.png' width="200px">

<hr>
<ul>
<li>Posted by 博客园·<a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a> | <a target="_blank" rel="noopener" href="http://wendingding.com/">花田半亩</a></li>
<li>联系作者 简书·<a target="_blank" rel="noopener" href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2017/09/04/jQuery%E7%B3%BB%E5%88%97%20%5B11%5D-jQuery%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%5B%E6%8F%92%E4%BB%B6%5D/" class="prev">上一篇</a><a href="/2017/09/01/jQuery%E7%B3%BB%E5%88%97%20%5B09%5D-jQuery%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%5B%E5%BC%80%E5%A7%8B%5D/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 420.5k (字)</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>