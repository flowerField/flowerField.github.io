<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> jQuery系列 [11]-jQuery框架源码解读[插件] · 花田半亩</title><meta name="description" content="jQuery系列 [11]-jQuery框架源码解读[插件] - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="花田半亩" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="https://github.com/flowerField" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">jQuery系列 [11]-jQuery框架源码解读[插件]</h1><div class="post-info">Sep 4, 2017<span class="post-count"></span> ✧ 字数统计:3.6k(字) &nbsp;&nbsp; ♨︎ 阅读时长:15(分钟)</div><div class="post-content"><blockquote>
<p>这篇文章将主要介绍jQuery框架的插件机制，包括但不限于<code>jQuery.extend</code>和<code>jQuery.fn.extend</code>方法的设计和使用，JavaScript体系中的常用概念以及jQuery插件的使用等。</p>
</blockquote>
<h3 id="1-0-源码解读"><a href="#1-0-源码解读" class="headerlink" title="1.0 源码解读"></a>1.0 源码解读</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//声明一堆的变量length 为实参的个数</span></span><br><span class="line">	<span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</span><br><span class="line">		target = <span class="built_in">arguments</span>[ <span class="number">0</span> ] || &#123;&#125;,</span><br><span class="line">		i = <span class="number">1</span>,</span><br><span class="line">		length = <span class="built_in">arguments</span>.length,</span><br><span class="line">		deep = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Handle a deep copy situation</span></span><br><span class="line">	<span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">&quot;boolean&quot;</span> ) &#123;</span><br><span class="line">		deep = target;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Skip the boolean and the target</span></span><br><span class="line">		target = <span class="built_in">arguments</span>[ i ] || &#123;&#125;;</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></span><br><span class="line">	<span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">&quot;object&quot;</span> &amp;&amp; !isFunction( target ) ) &#123;</span><br><span class="line">		target = &#123;&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Extend jQuery itself if only one argument is passed</span></span><br><span class="line">	<span class="keyword">if</span> ( i === length ) &#123;</span><br><span class="line">		target = <span class="built_in">this</span>;</span><br><span class="line">		i--;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Only deal with non-null/undefined values</span></span><br><span class="line">		<span class="keyword">if</span> ( ( options = <span class="built_in">arguments</span>[ i ] ) != <span class="literal">null</span> ) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Extend the base object</span></span><br><span class="line">			<span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</span><br><span class="line">				src = target[ name ];</span><br><span class="line">				copy = options[ name ];</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Prevent never-ending loop</span></span><br><span class="line">				<span class="keyword">if</span> ( target === copy ) &#123;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Recurse if we&#x27;re merging plain objects or arrays</span></span><br><span class="line">				<span class="keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject( copy ) ||</span><br><span class="line">					( copyIsArray = <span class="built_in">Array</span>.isArray( copy ) ) ) ) &#123;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span> ( copyIsArray ) &#123;</span><br><span class="line">						copyIsArray = <span class="literal">false</span>;</span><br><span class="line">						clone = src &amp;&amp; <span class="built_in">Array</span>.isArray( src ) ? src : [];</span><br><span class="line"></span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						clone = src &amp;&amp; jQuery.isPlainObject( src ) ? src : &#123;&#125;;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// Never move original objects, clone them</span></span><br><span class="line">					target[ name ] = jQuery.extend( deep, clone, copy );</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Don&#x27;t bring in undefined values</span></span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">					target[ name ] = copy;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Return the modified object</span></span><br><span class="line">	<span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为jQuery添加一堆工具方法,对象参数中所有的成员都将直接添加在jQuery函数身上成为jQuery的静态方法</span></span><br><span class="line">jQuery.extend( &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Unique for each copy of jQuery on the page</span></span><br><span class="line">	<span class="comment">// 简单测试下得到的结果是：jQuery33104605303773584173</span></span><br><span class="line">	<span class="comment">// 确保页面中的jQuery副本是唯一的，（jQuery + 版本号 + 随机数） =&gt; 格式处理</span></span><br><span class="line">	<span class="attr">expando</span>: <span class="string">&quot;jQuery&quot;</span> + ( version + <span class="built_in">Math</span>.random() ).replace( <span class="regexp">/\D/g</span>, <span class="string">&quot;&quot;</span> ),</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Assume jQuery is ready without the ready module</span></span><br><span class="line">	<span class="comment">// 是否已经准备就绪</span></span><br><span class="line">	<span class="attr">isReady</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//错误处理方法：根据传入的消息创建一个错误对象并抛出异常</span></span><br><span class="line">	<span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> msg </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( msg );</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//空函数</span></span><br><span class="line">	<span class="attr">noop</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用于判断指定参数是否是一个纯粹的对象</span></span><br><span class="line">	<span class="comment">//所谓&quot;纯粹的对象&quot;，就是该对象是通过&quot;&#123;&#125;&quot;或&quot;new Object&quot;创建的 .排除了数组、自定义构造函数创建的对象以及函数等类型</span></span><br><span class="line">	<span class="attr">isPlainObject</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> proto, Ctor;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Detect obvious negatives</span></span><br><span class="line">		<span class="comment">// Use toString instead of jQuery.type to catch host objects</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//如果参数为null | undefined 或者在调用Object.prototype.toString.call(参数)的时候得到的结果不是[object Object]则直接返回false</span></span><br><span class="line">		<span class="keyword">if</span> ( !obj || toString.call( obj ) !== <span class="string">&quot;[object Object]&quot;</span> ) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//获取当前对象的原型对象，其实是调用了Object.getPrototypeOf(参数) 方法</span></span><br><span class="line">		proto = getProto( obj );</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Objects with no prototype (e.g., `Object.create( null )`) are plain</span></span><br><span class="line">		<span class="comment">//监测 没有原型对象的最纯净的对象 例如使用Object.create( null )创建的对象</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( !proto ) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Objects with prototype are plain iff they were constructed by a global Object function</span></span><br><span class="line">		<span class="comment">//如果原型对象上拥有constructor属性(前一句的结果为true) 那么就返回proto.constructor的值</span></span><br><span class="line">		<span class="comment">//如果原型对象是Object.prototype 那么Object.prototype.constructor ==&gt; ƒ Object() &#123; [native code] &#125;</span></span><br><span class="line">		Ctor = hasOwn.call( proto, <span class="string">&quot;constructor&quot;</span> ) &amp;&amp; proto.constructor;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//检查Ctor是否是函数 且函数字符串是否全等于function Object() &#123; [native code] &#125;</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">typeof</span> Ctor === <span class="string">&quot;function&quot;</span> &amp;&amp; fnToString.call( Ctor ) === ObjectFunctionString;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用于判断指定参数是否是一个空对象</span></span><br><span class="line">	<span class="comment">//所谓&quot;空对象&quot;，即不包括任何可枚举(自定义)的属性。简而言之，就是该对象没有属性可以通过for...in迭代。</span></span><br><span class="line">	<span class="attr">isEmptyObject</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* eslint-disable no-unused-vars */</span></span><br><span class="line">		<span class="comment">// See https://github.com/eslint/eslint/issues/6125</span></span><br><span class="line">		<span class="keyword">var</span> name;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> ( name <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Evaluates a script in a global context</span></span><br><span class="line">	<span class="comment">//用于全局性地执行一段JavaScript代码,内部调用DOMEval方法实现</span></span><br><span class="line">	<span class="comment">//其作用与常规的JavaScript eval()函数相似。区别自傲与jQuery.globalEval()执行代码的作用域为全局作用域。</span></span><br><span class="line">        <span class="comment">//使用示例：$.globalEval( &quot;var a =1&quot; ); 该行代码将在全局作用域中定义变量a</span></span><br><span class="line">	<span class="attr">globalEval</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> code </span>) </span>&#123;</span><br><span class="line">		DOMEval( code );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//常用的迭代方法，可以用来遍历数组|对象|jQ实例对象(伪数组)</span></span><br><span class="line">	<span class="comment">//该方法同$(&quot;xxx&quot;).each() 方法保持一致</span></span><br><span class="line">	<span class="comment">//第一个参数：要遍历的对象| 数组 | jQ实例对象</span></span><br><span class="line">	<span class="attr">each</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> obj, callback </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> length, i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//如果参数是伪数组那么使用普通的for循环来进行遍历</span></span><br><span class="line">		<span class="keyword">if</span> ( isArrayLike( obj ) ) &#123;</span><br><span class="line">			length = obj.length;</span><br><span class="line">			<span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">				<span class="comment">//调用回到函数，把当前的value值绑定给函数的this [each方法的回调函数中this--&gt; value值]</span></span><br><span class="line">				<span class="comment">//把当前循环的key和value值(这里是i和obj[i])作为参数传递给callback回调函数</span></span><br><span class="line">				<span class="comment">//检查回调函数的返回值，如果返回的是false，那么就退出循环</span></span><br><span class="line">				<span class="keyword">if</span> ( callback.call( obj[ i ], i, obj[ i ] ) === <span class="literal">false</span> ) &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//如果是普通的对象那么使用for..in循环来进行遍历</span></span><br><span class="line">			<span class="keyword">for</span> ( i <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">				<span class="comment">//同上面的代码保持一致</span></span><br><span class="line">				<span class="keyword">if</span> ( callback.call( obj[ i ], i, obj[ i ] ) === <span class="literal">false</span> ) &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//把遍历的对象返回,链式编程的代码风格</span></span><br><span class="line">		<span class="keyword">return</span> obj;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Support: Android &lt;=4.0 only</span></span><br><span class="line">	<span class="comment">// 工具方法，用于清空字符串前面或者是后面的N个空格</span></span><br><span class="line">	<span class="comment">// 在ES5中js提供了原生的trim方法来清除字符串前后的1个或多个空格</span></span><br><span class="line">	<span class="comment">// 这里主要是通过正则表达式去进行匹配，把匹配到的内容替换为空字符串&quot;&quot;</span></span><br><span class="line">	<span class="attr">trim</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> text </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> text == <span class="literal">null</span> ?</span><br><span class="line">			<span class="string">&quot;&quot;</span> :</span><br><span class="line">			( text + <span class="string">&quot;&quot;</span> ).replace( rtrim, <span class="string">&quot;&quot;</span> );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// results is for internal usage only</span></span><br><span class="line">	<span class="comment">// 结果仅共内部使用</span></span><br><span class="line">	<span class="comment">// 该函数用于将一个类数组对象(伪数组)转换为真正的数组对象</span></span><br><span class="line">	<span class="comment">// 所谓&quot;类数组对象&quot;就是一个常规的Object对象，但它和数组对象非常相似：具备length属性，并以0、1、2、3……等数字作为属性名。</span></span><br><span class="line">	<span class="attr">makeArray</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> arr, results </span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 初始化ret为空数组</span></span><br><span class="line">		<span class="keyword">var</span> ret = results || [];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( arr != <span class="literal">null</span> ) &#123;</span><br><span class="line">			<span class="comment">//检查传入的参数是否是伪数组</span></span><br><span class="line">			<span class="keyword">if</span> ( isArrayLike( <span class="built_in">Object</span>( arr ) ) ) &#123;</span><br><span class="line">				<span class="comment">//如果是伪数组，那么合并ret和arr 并返回</span></span><br><span class="line">				<span class="comment">//如果arr是字符串那么jQuery.merge(ret,[arr]) ，否则jQuery.merge(ret,arr)</span></span><br><span class="line">				jQuery.merge( ret,</span><br><span class="line">					<span class="keyword">typeof</span> arr === <span class="string">&quot;string&quot;</span> ?</span><br><span class="line">					[ arr ] : arr</span><br><span class="line">				);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">//如果参数不是伪数组，那么直接把arr中的每个数据都添加到新的数组中</span></span><br><span class="line">				<span class="comment">//push.call( ret, arr ) 就是是 [].push.call(ret,arr) =&gt; [].push(arr)</span></span><br><span class="line">				push.call( ret, arr );</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//返回处理完的数组对象</span></span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 该方法用于在数组中搜索指定的值，并返回其索引值。如果数组中不存在该值，则返回 -1。</span></span><br><span class="line">	<span class="comment">// 第一个参数 用于查找的值</span></span><br><span class="line">	<span class="comment">// 第二个参数 指定被查找的数组</span></span><br><span class="line">	<span class="comment">// 第三个参数 指定从数组的指定索引位置开始查找，默认为 0</span></span><br><span class="line">        <span class="comment">// 如果数组中存在多个相同的值，则以查找到的第一个值的索引为准</span></span><br><span class="line">	<span class="comment">// 使用示例：$.inArray(&quot;文顶顶&quot;,[&quot;demoA&quot;,&quot;demoB&quot;,&quot;wendingding.com&quot;,&quot;文顶顶&quot;,&quot;demoC&quot;,&quot;end&quot;],4)</span></span><br><span class="line">	<span class="comment">// 上面的代码表示从数组中索引为4的位置开始查找&quot;文顶顶&quot;这个元素项，返回的结果为-1，最后一个参数不传递则返回3</span></span><br><span class="line">	<span class="attr">inArray</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> elem, arr, i </span>) </span>&#123;</span><br><span class="line">		<span class="comment">//如果参数是null或undefined那么直接返回-1</span></span><br><span class="line">		<span class="comment">//否则通过调用indexOf方法实现 indexOf.call( arr, elem, i ) =&gt; arr.indexOf(elem,i)</span></span><br><span class="line">		<span class="keyword">return</span> arr == <span class="literal">null</span> ? -<span class="number">1</span> : indexOf.call( arr, elem, i );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Support: Android &lt;=4.0 only, PhantomJS 1 only</span></span><br><span class="line">	<span class="comment">// push.apply(_, arraylike) throws on ancient WebKit</span></span><br><span class="line">	<span class="comment">//该方法用于合并两个数组</span></span><br><span class="line">	<span class="attr">merge</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> first, second </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> len = +second.length,</span><br><span class="line">			j = <span class="number">0</span>,</span><br><span class="line">			i = first.length;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> ( ; j &lt; len; j++ ) &#123;</span><br><span class="line">			<span class="comment">//通过普通的for循环来遍历第二个数组</span></span><br><span class="line">			<span class="comment">//把第二个数组的元素依次追加在第一个数组的后面</span></span><br><span class="line">			first[ i++ ] = second[ j ];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//更新数组的长度值</span></span><br><span class="line">		first.length = i;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> first;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 过滤函数用于过滤数组</span></span><br><span class="line">	<span class="comment">// 参数1 待过滤的数组</span></span><br><span class="line">	<span class="comment">// 参数2 过滤数组的具体函数</span></span><br><span class="line">	<span class="comment">// 参数3 布尔类型的值</span></span><br><span class="line">	<span class="comment">// 		为true则函数返回数组中由过滤函数返回 true 的元素</span></span><br><span class="line">	<span class="comment">//      为false则函数返回数组中由过滤函数返回false的元素</span></span><br><span class="line">	<span class="attr">grep</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, invert </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//初始化一堆的变量</span></span><br><span class="line">		<span class="keyword">var</span> callbackInverse,</span><br><span class="line">			matches = [],   <span class="comment">//空数组</span></span><br><span class="line">			i = <span class="number">0</span>,			<span class="comment">//索引值为0</span></span><br><span class="line">			length = elems.length,	<span class="comment">//待过滤数组的长度</span></span><br><span class="line">			callbackExpect = !invert;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Go through the array, only saving the items</span></span><br><span class="line">		<span class="comment">// that pass the validator function</span></span><br><span class="line">		<span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">			<span class="comment">//每循环一次就把当前的元素和对应的索引传递给回调函数，并保存回调函数的返回值取反</span></span><br><span class="line">			callbackInverse = !callback( elems[ i ], i );</span><br><span class="line">			<span class="keyword">if</span> ( callbackInverse !== callbackExpect ) &#123;</span><br><span class="line">				<span class="comment">//把过滤后的元素收集保存到新的数组中</span></span><br><span class="line">				matches.push( elems[ i ] );</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//返回过滤后得到的数据，是一个新的数组</span></span><br><span class="line">		<span class="keyword">return</span> matches;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// arg is for internal usage only</span></span><br><span class="line">	<span class="comment">// arg仅用于内部使用的情况</span></span><br><span class="line">	<span class="comment">// 数组映射方法( 将一个数组中的元素转换到另一个数组中 )</span></span><br><span class="line">	<span class="comment">// 参数1 ：待处理的数组</span></span><br><span class="line">	<span class="comment">// 参数2 : 具体的处理函数</span></span><br><span class="line">	<span class="comment">// 参数3 : arg</span></span><br><span class="line">	<span class="attr">map</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, arg </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//初始化一堆的变量</span></span><br><span class="line">		<span class="keyword">var</span> length, value,</span><br><span class="line">			i = <span class="number">0</span>,			<span class="comment">//索引值为0</span></span><br><span class="line">			ret = [];		<span class="comment">//ret为空的数组</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Go through the array, translating each of the items to their new values</span></span><br><span class="line">		<span class="comment">// 遍历数组把数组中的每一项都转换为一个新的值</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//检查是否是伪数组</span></span><br><span class="line">		<span class="keyword">if</span> ( isArrayLike( elems ) ) &#123;</span><br><span class="line">			length = elems.length;		<span class="comment">//获取待处理的伪数组的长度</span></span><br><span class="line">			<span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">				<span class="comment">//循环，每循环一次就调用处理函数并把当前的key和value值作为参数传递进去</span></span><br><span class="line">				<span class="comment">//收集回调函数的返回值</span></span><br><span class="line">				value = callback( elems[ i ], i, arg );</span><br><span class="line"></span><br><span class="line">				<span class="comment">//如果回调函数的范返回值不为空，那么就把该返回值添加到数组中并最终返回</span></span><br><span class="line">				<span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">					ret.push( value );</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Go through every key on the object,</span></span><br><span class="line">		<span class="comment">//	如果是普通的对象，那么就使用for...in循环来进行遍历</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> ( i <span class="keyword">in</span> elems ) &#123;</span><br><span class="line">				value = callback( elems[ i ], i, arg );</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">					ret.push( value );</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Flatten any nested arrays</span></span><br><span class="line">		<span class="comment">// 等价于 [].concat(ret) 问题：为什么不直接范湖ret数组呢？</span></span><br><span class="line">		<span class="keyword">return</span> concat.apply( [], ret );</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// A global GUID counter for objects</span></span><br><span class="line">	<span class="comment">// 全局的GUID计数器</span></span><br><span class="line">	<span class="attr">guid</span>: <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// jQuery.support is not used in Core but other projects attach their</span></span><br><span class="line">	<span class="comment">// properties to it so it needs to exist.</span></span><br><span class="line">        <span class="comment">// 就是个空对象 &#123;&#125; 不在核心中使用，但其他项目将它们的属性附加到它，因此它需要存在。</span></span><br><span class="line">	<span class="attr">support</span>: support</span><br><span class="line">&#125; );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-0-jQuery框架的插件处理机制"><a href="#2-0-jQuery框架的插件处理机制" class="headerlink" title="2.0 jQuery框架的插件处理机制"></a>2.0 jQuery框架的插件处理机制</h3><p>jQuery框架中上面列出的这几百行代码主要做了两件事情。</p>
<blockquote>
<p>❏ 在jQuery的基础上拓展了<code>jQuery.extend</code>方法和<code>jQuery.fn.extend</code>方法。<br>❏ 调用<code>jQuery.extend</code>方法来为jQuery批量的添加一堆的静态方法(如<code>map</code>和<code>grep</code>等)。</p>
</blockquote>
<p><span style='border:1px solid #000;padding:5px 20px;'><strong>jQuery插件方法的实现</strong></span></p>
<p>jQuery官方框架中在实现<code>jQuery.extend</code>和<code>jQuery.fn.extend</code>这两个方法的时候用了接近80行代码，具体的实现细节比较复杂，这里给出一个简易版本来帮助大家理解这两个方法都做了什么事情。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span> (<span class="params">objT</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//遍历参数对象，获取对象中的每个成员添加在jQuery或者是jQuery.fn对象。</span></span><br><span class="line"> 	<span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> objT)</span><br><span class="line"> 		&#123;</span><br><span class="line"> 		    <span class="comment">// 过滤掉原型对象的成员，如果仅仅只处理函数还可以对参数的类型进行判断</span></span><br><span class="line"> 			<span class="keyword">if</span> (<span class="built_in">Object</span>.hasOwnProperty(key))</span><br><span class="line"> 			&#123;</span><br><span class="line"> 			    <span class="comment">//this的值由函数的调用方式决定</span></span><br><span class="line">			    <span class="built_in">this</span>[key] = objT[key];</span><br><span class="line"> 			&#125;</span><br><span class="line"> 		&#125;</span><br><span class="line">     &#125;;</span><br></pre></td></tr></table></figure>

<img src='../../../../src/jq_03.png'>

<p>其实简单点说，这两个的方法的功能就是把传递给他们的参数(对象类型)中的所有成员都添加到对应的对象中(<span style='color:#195'>如果是jQuery.fn.extend方法，那么就添加到jQuery的原型对象身上作为原型成员来使用，如果是jQuery.extend方法，则直接添加到jQuery身上作为静态方法来使用</span>)。</p>
<p>在这两个方法的实现中巧妙利用了this指向的对象由函数调用方式决定这一特点，做到<code>jQuery.extend = jQuery.fn.extend</code>。也因此，虽然在<code>jQuery.extend方法</code>和<code>jQuery.fn.extend方法</code>的函数体相同，但由于内部使用了this的缘故，所以在单独调用这两个方法的时候它们是区分处理的。</p>
<p><span style='border:1px solid #000;padding:5px 20px;'><strong>jQuery插件方法的调用</strong></span></p>
<p>这里给出上面代码中jQuery.extend()调用的简化版本。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><br><span class="line">    <span class="comment">//判断指定参数是否是一个纯粹的对象</span></span><br><span class="line">    <span class="attr">isPlainObject</span>:<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断指定参数是否是一个空的对象</span></span><br><span class="line">    <span class="attr">isEmptyObject</span>:<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//迭代方法，用来遍历对象、数组和伪数组</span></span><br><span class="line">    <span class="attr">each</span>:<span class="function"><span class="keyword">function</span>(<span class="params"> obj, callback</span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//清除字符串前后的N个空格，同ES5中字符串的trim方法</span></span><br><span class="line">    <span class="attr">trim</span>:<span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把伪数组对象转换为数组</span></span><br><span class="line">    makeArray：<span class="function"><span class="keyword">function</span>(<span class="params">arr, results </span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//该方法用于在数组中搜索指定的值，并返回其索引值。</span></span><br><span class="line">    <span class="attr">inArray</span>:<span class="function"><span class="keyword">function</span>(<span class="params">elem, arr, i</span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//该方法用于合并两个数组</span></span><br><span class="line">    <span class="attr">merge</span>:<span class="function"><span class="keyword">function</span>(<span class="params">first, second </span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这是一个过滤函数，主要用于过滤数组</span></span><br><span class="line">    <span class="attr">grep</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, invert </span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//数组映射方法，把一个数组中的元素转换到另一个数组中</span></span><br><span class="line">    <span class="attr">map</span>:<span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, arg </span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>jQuery.extend() 和jQuery.fn.extend() </code>这两个方法在jQuery框架中被大量使用，绝大多数的方法均通过调用者两个函数来添加到jQuery身上或者是jQuery的原型对象身上，这种为jQuery和jQuery原型对象拓展方法(功能)的机制被称为<strong>插件机制</strong>。jQuery框架的官方团队维护了一个<a target="_blank" rel="noopener" href="https://plugins.jquery.com/">jQuery官方插件列表</a>，我们可以在使用jQuery的基础上通过引入对应的jQuery插件来快速实现特定的功能。当然，除jQuery官方团队维护的插件之外，我们还能在互联网上找到很多其它开发人员为jQuery写的一些优秀插件，在具体的开发中可以根据项目的需求来综合评估是否直接使用jQuery插件来实现。</p>
<p>总体来说，jQuery的插件实现是比较简单的。如果你想要自己写一个jQuery插件，那么只需要创建一个新的js文件，该文件推荐命名为<code>jQuery.xx.js</code>的形式。然后在js代码中通过调用<code>jQuery.extend() 和jQuery.fn.extend() </code>方法来拓展功能即可。</p>
<div class='tip'>常见的插件实现形式是：把对应的代码包裹到闭包中，然后传递jQuery对象。</div>

<img src='../../../../z.png' width="200px">

<hr>
<ul>
<li>Posted by 博客园·<a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a> | <a target="_blank" rel="noopener" href="http://wendingding.com/">花田半亩</a></li>
<li>联系作者 简书·<a target="_blank" rel="noopener" href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2017/09/13/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%20%5B001%5D-%E5%B7%A5%E4%BD%9C%E5%89%8D5%E5%B9%B4%EF%BC%8C%E5%86%B3%E5%AE%9A%E4%BD%A0%E4%B8%80%E7%94%9F%E7%9A%84%E8%B4%A2%E5%AF%8C/" class="prev">上一篇</a><a href="/2017/09/03/jQuery%E7%B3%BB%E5%88%97%20%5B10%5D-jQuery%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%5B%E7%BB%93%E6%9E%84%5D/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 421.3k (字)</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>