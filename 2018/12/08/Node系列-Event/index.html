<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Node系列-Event · 花田半亩</title><meta name="description" content="Node系列-Event - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="花田半亩" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="https://github.com/flowerField" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Node系列-Event</h1><div class="post-info">Dec 8, 2018<span class="post-count"></span> ✧ 字数统计:2.2k(字) &nbsp;&nbsp; ♨︎ 阅读时长:9(分钟)</div><div class="post-content"><h4 id="1-0-EventEmitter介绍"><a href="#1-0-EventEmitter介绍" class="headerlink" title="1.0 EventEmitter介绍"></a>1.0 EventEmitter介绍</h4><p>Node中的<code>event</code>模块实现了事件处理相关功能，在该模块中定义了<a href="">EventEmitter类</a>。</p>
<p>在Node中，所有可能触发事件的对象都是继承了<a href="">EventEmitter类</a>的子类的实例对象，该类定义了诸多方法，譬如添加事件监听和移除事件监听以及自动触发事件等(通过下面的打印可以发现，这些方法均定义在原型对象上面)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node</span><br><span class="line">&gt; <span class="built_in">console</span>.dir(events,&#123;<span class="attr">showHidden</span>:<span class="literal">true</span>,<span class="attr">colors</span>:<span class="literal">true</span>,<span class="attr">depth</span>:<span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line">&#123; [<span class="built_in">Function</span>: EventEmitter]</span><br><span class="line">  [length]: <span class="number">0</span>,</span><br><span class="line">  [name]: <span class="string">&#x27;EventEmitter&#x27;</span>,</span><br><span class="line">  [prototype]: </span><br><span class="line">   EventEmitter &#123;</span><br><span class="line">     [<span class="title">constructor</span>]: [<span class="title">Circular</span>],</span><br><span class="line">     <span class="title">domain</span>: <span class="title">undefined</span>,</span><br><span class="line">     <span class="title">_events</span>: <span class="title">undefined</span>,</span><br><span class="line">     <span class="title">_maxListeners</span>: <span class="title">undefined</span>,</span><br><span class="line">     <span class="title">setMaxListeners</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">getMaxListeners</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">emit</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">addListener</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">on</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">prependListener</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">once</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">prependOnceListener</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">removeListener</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">removeAllListeners</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">listeners</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">listenerCount</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">eventNames</span>: [<span class="title">Object</span>] &#125;,</span><br><span class="line">  <span class="title">EventEmitter</span>: [<span class="title">Circular</span>],</span><br><span class="line">  <span class="title">usingDomains</span>: <span class="title">true</span>,</span><br><span class="line">  <span class="title">defaultMaxListeners</span>: [<span class="title">Getter</span>/<span class="title">Setter</span>],</span><br><span class="line">  <span class="title">init</span>: &#123; [<span class="built_in">Function</span>] [length]: <span class="number">0</span>, [name]: <span class="string">&#x27;&#x27;</span>, [prototype]: [<span class="built_in">Object</span>] &#125;,</span><br><span class="line">  <span class="attr">listenerCount</span>: &#123; [<span class="built_in">Function</span>] [length]: <span class="number">2</span>, [name]: <span class="string">&#x27;&#x27;</span>, [prototype]: [<span class="built_in">Object</span>] &#125; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>EventEmitter结构说明</strong></p>
<p>上面的代码是在REPL环境中直接通过<code>console.dir方法</code>来打印events整个模块的输出。为了方便理解，我这里另外再提供一份EventEmitter构造函数的具体实现作为对照和参考。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">EventEmitter</span>(<span class="params"></span>) </span>&#123; EventEmitter.init.call(<span class="built_in">this</span>); &#125;</span><br><span class="line">EventEmitter.usingDomains = <span class="literal">false</span>;</span><br><span class="line">EventEmitter.prototype._events = <span class="literal">undefined</span>;</span><br><span class="line">EventEmitter.prototype._eventsCount = <span class="number">0</span>; <span class="comment">// 事件数量</span></span><br><span class="line">EventEmitter.prototype._maxListeners = <span class="literal">undefined</span>; <span class="comment">// 最大的监听器数</span></span><br></pre></td></tr></table></figure>

<p><code>events</code>模块中的<a href="">EventEmitter</a>指向的是模块自身。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node</span><br><span class="line">&gt; events == events.EventEmitter</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><a href="">EventEmitter</a>构造函数身上有个比较重要的静态方法即<code>init方法</code>，该方法主要用来根据条件执行初始化操作，所谓的初始化具体点讲其实就是设置<code>_events</code>、<code>_maxListeners</code>，下面列出该方法的具体实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">EventEmitter.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>._events === <span class="literal">undefined</span> || <span class="built_in">this</span>._events === <span class="built_in">Object</span>.getPrototypeOf(<span class="built_in">this</span>)._events)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">this</span>._events = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">    <span class="built_in">this</span>._eventsCount = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>._maxListeners = <span class="built_in">this</span>._maxListeners || <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="">EventEmitter</a>的<code>defaultMaxListeners</code>属性内部实现了Getter和Setter方法，该属性用来设置和获取指定事件可以绑定的最大事件处理函数数量，该属性默认值为10。对于默认事件绑定数量，我们可以通过在REPL环境中直接打印<code>events.defaultMaxListeners</code>来进行查看。此外，在<a href="">EventEmitter</a>原型对象上面，提供了<code>setMaxListeners</code>和<code>getMaxListeners</code>方法来对<code>_maxListeners</code>属性进行获取和设置。</p>
<img src='../../../../src/node_event.png'>

<h4 id="2-0-Event相关方法"><a href="#2-0-Event相关方法" class="headerlink" title="2.0 Event相关方法"></a>2.0 Event相关方法</h4><p>前文对<code>events</code>模块中的<a href="">EventEmitter构造函数</a>进行了简单介绍，接下来将主要说明具体事件监听绑定、移除和触发等相关的方法。</p>
<p><strong>事件的监听(绑定)</strong></p>
<p>当需要给指定对象添加事件监听(绑定事件处理函数)的时候，可以使用EventEmitter原型对象中的<code>on方法</code>或者是<code>addListener方法</code>，这两个方法的区别仅仅在于方法名，内部的实现一模一样，均调用events模块中的<code>_addListener方法</code>来实现。</p>
<blockquote>
<p><strong>_addListener方法核心过程</strong></p>
</blockquote>
<blockquote>
<p>① 验证监听器是否为函数对象。<br>② 避免类型为<code>newListener</code>的事件类型，造成递归调用。<br>③ 优化单个监听器的场景，不需使用额外的数组对象。<br>④ 基于prepend参数的值，控制监听器的添加顺序。</p>
</blockquote>
<p>这里先介绍事件监听(绑定)相关方法的语法，然后给出简短示例。</p>
<ul>
<li><code>EventEmitterInstance.on(event,listener)</code></li>
<li><code>EventEmitterInstance.addListener(event,listener)</code></li>
</ul>
<p><strong>参数说明</strong> <code>on</code>方法和<code>addListener</code>方法接受两个参数，其中event代表的是事件的类型(事件的名称，譬如<code>data</code>、<code>request</code>等)，而listener参数代表的是侦听器(事件处理函数)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备注：demo.js文件的内容</span></span><br><span class="line"><span class="comment">//001 导入模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//002 创建server服务</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">//003 事件监听</span></span><br><span class="line"><span class="comment">// server.on(&quot;request&quot;,function(req,res)&#123;</span></span><br><span class="line">server.addListener(<span class="string">&quot;request&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;request--事件被触发&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;req.url:&quot;</span>,req.url);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//005 结束响应</span></span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//004 开启监听</span></span><br><span class="line">server.listen(<span class="number">4001</span>,<span class="string">&quot;127.0.0.1&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>切换到当前所在目录，在终端中通过<code>node demo.js</code>命令执行上面的代码开启服务器端口监听，然后在浏览器中输入<a target="_blank" rel="noopener" href="http://127.0.0.1:4001/">http://127.0.0.1:4001</a> 地址，能够得到下面的打印输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node demo.js </span><br><span class="line">request--事件被触发</span><br><span class="line">req.url: /</span><br><span class="line">request--事件被触发</span><br><span class="line">req.url: /favicon.ico</span><br></pre></td></tr></table></figure>

<p><strong>备注</strong> 在给指定对象绑定事件监听的时候，支持给某类型的事件(譬如<code>request</code>)绑定多个处理函数，默认最多可以绑定10个且支持给指定对象绑定多种类型的事件监听(譬如<code>request</code>事件、<code>end</code>事件等)。绑定处理函数的数量可以通过<code>getMaxListeners</code>和<code>setMaxListeners</code>方法来操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">&quot;events&quot;</span>);</span><br><span class="line"><span class="comment">//获取events模块(EventEmitter构造函数)的defaultMaxListeners属性值</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;defaultMaxListeners==&quot;</span>,events.defaultMaxListeners);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;默认getMaxListeners ==&quot;</span>,rs.getMaxListeners());</span><br><span class="line">rs.setMaxListeners(<span class="number">20</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;设置getMaxListeners == 20&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;最新getMaxListeners ==&quot;</span>,rs.getMaxListeners());</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印信息</span></span><br><span class="line">defaultMaxListeners== <span class="number">10</span></span><br><span class="line">默认getMaxListeners == <span class="number">10</span></span><br><span class="line">设置getMaxListeners == <span class="number">20</span></span><br><span class="line">最新getMaxListeners == <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>除了上面介绍的<code>on</code>方法和<code>addListener</code>方法之外，<code>once</code>方法也能用来给指定的对象添加事件监听(绑定事件处理函数)，区别在于<code>once</code>方法当事件处理函数执行一次后绑定就会立即被解除，也就是该事件处理函数只会被执行一次。下面给出具体语法和简短示例：</p>
<ul>
<li><code>EventEmitterInstance.once(event,listener)</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备注：once.js文件的内容</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> rs = fs.createReadStream(<span class="string">&quot;Hi.text&quot;</span>,&#123;<span class="attr">highWaterMark</span>:<span class="number">10</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">//001 监听rs实例对象的data事件，当事件触发的时候执行回调函数组织读取的Buffer数据</span></span><br><span class="line">rs.addListener(<span class="string">&quot;data&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;data...事件被触发&quot;</span>);</span><br><span class="line">    data.push(chunk);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//002 监听rs实例对象的end事件，该事件当文件数据流读取完毕的时候触发</span></span><br><span class="line"><span class="comment">//    因为end事件只会被触发一次，所以完全可使用once方法来监听和绑定</span></span><br><span class="line">rs.once(<span class="string">&quot;end&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;end····事件被触发&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> buf = Buffer.concat(data);</span><br><span class="line">    <span class="built_in">console</span>.log(buf.toString());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//备注：执行once.js文件测试once方法的使用</span></span><br><span class="line">wendingding$ node once.js </span><br><span class="line">data...事件被触发</span><br><span class="line">data...事件被触发</span><br><span class="line">data...事件被触发</span><br><span class="line">data...事件被触发</span><br><span class="line">end····事件被触发</span><br><span class="line">文顶顶：嗨，很高兴遇见你！</span><br></pre></td></tr></table></figure>

<p><strong>移除事件监听(解绑)</strong></p>
<p>若需要解除指定对象的事件侦听，则可使用移除事件相关的方法。EventEmitter提供了<code>removeListener</code>方法和<code>removeAllListeners</code>方法来进行解绑操作，<code>listeners</code>方法可以获取当前对象中指定事件绑定的所有处理函数。下面先列出语法然后给出简短代码示例：</p>
<ul>
<li><code>EventEmitterInstance.listeners(event)</code></li>
<li><code>EventEmitterInstance.removeListener(event,listener)</code></li>
<li><code>EventEmitterInstance.removeAllListeners(event)</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备注：removeListener.js文件的内容</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestHandleOne</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;url == &quot;</span>,req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;request1····事件被触发&quot;</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestHandleTwo</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;url == &quot;</span>,req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;request2····事件被触发&quot;</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//给server对象添加request事件监听</span></span><br><span class="line">server.addListener(<span class="string">&quot;request&quot;</span>,requestHandleOne)</span><br><span class="line">server.addListener(<span class="string">&quot;request&quot;</span>,requestHandleTwo)</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启服务端口监听</span></span><br><span class="line">server.listen(<span class="number">4002</span>,<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取事件监听处理函数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;request事件处理函数列表：&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> handleList = server.listeners(<span class="string">&quot;request&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> handleList)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;事件处理函数：&quot;</span>,handleList[key].name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;移除前：&quot;</span>,server.listenerCount(<span class="string">&quot;request&quot;</span>));</span><br><span class="line"><span class="comment">//移除事件监听（解除单个事件处理函数）</span></span><br><span class="line">server.removeListener(<span class="string">&quot;request&quot;</span>,requestHandleOne);</span><br><span class="line"></span><br><span class="line"><span class="comment">//移除事件监听（解除指定事件的所有处理函数）</span></span><br><span class="line"><span class="comment">//server.removeAllListeners(&quot;request&quot;);</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;移除后：&quot;</span>,server.listenerCount(<span class="string">&quot;request&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">&quot;events&quot;</span>);</span><br><span class="line"><span class="comment">//获取指定对象中指定事件侦听的数量</span></span><br><span class="line"><span class="keyword">var</span> server_request_listenerCount = events.EventEmitter.listenerCount(server,<span class="string">&quot;request&quot;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;server对象中request事件的侦听数量：&quot;</span>,server_request_listenerCount);</span><br></pre></td></tr></table></figure>
<p><strong>代码说明</strong> </p>
<p>在上面的代码中我们首先创建了服务器<code>sever</code>对象，然后开启了服务器4002端口监听，并使用方法<code>addListener</code>为<code>request</code>事件添加两个侦听(分别是<code>requestHandleOne</code>和<code>requestHandleTwo</code>)函数。</p>
<p><code>server.listeners(&quot;request&quot;)</code>函数用来获取sever对象上所有request事件处理函数列表。<br><code>server.listenerCount(&quot;request&quot;)</code>函数用来获取sever对象上所有request事件处理函数的数量。</p>
<p>此外，在events模块的<a href="">EventEmitter构造函数</a>身上拥有一个<code>listenerCount</code>方法，该方法接收两个参数(<code>对象，事件</code>)以获取特定对象身上指定事件处理函数的数量。运行JavaScript代码，并在浏览器中访问：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node removeListener.js </span><br><span class="line">request事件处理函数列表：</span><br><span class="line">事件处理函数： requestHandleOne</span><br><span class="line">事件处理函数： requestHandleTwo</span><br><span class="line">移除前： 2</span><br><span class="line">移除后： 1</span><br><span class="line">server对象中request事件的侦听数量： 1</span><br><span class="line">url ==  /</span><br><span class="line">request2····事件被触发</span><br><span class="line">url ==  /favicon.ico</span><br><span class="line">request2····事件被触发</span><br></pre></td></tr></table></figure>

<img src='../../../../z.png' width="200px">

<hr>
<ul>
<li>Posted by 博客园·<a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a> | <a target="_blank" rel="noopener" href="http://wendingding.com/">花田半亩</a></li>
<li>联系作者 简书·<a target="_blank" rel="noopener" href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/12/31/%E6%B1%9F%E6%B9%96%E5%A4%9C%E9%9B%A8%E7%B3%BB%E5%88%97%20%E6%96%AF%E4%BA%BA%E8%8B%A5%E5%BD%A9%E8%99%B9/" class="prev">上一篇</a><a href="/2018/12/07/Node%E7%B3%BB%E5%88%97-os/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 422k (字)</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>