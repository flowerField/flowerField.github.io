<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Node系列-global · 花田半亩</title><meta name="description" content="Node系列-global - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="花田半亩" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="https://github.com/flowerField" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Node系列-global</h1><div class="post-info">Dec 4, 2018<span class="post-count"></span> ✧ 字数统计:2.5k(字) &nbsp;&nbsp; ♨︎ 阅读时长:10(分钟)</div><div class="post-content"><div class='tip'>本文介绍Node中的全局对象，包括global本身以及控制台输出对象Console、require函数、定时器相关方法以及\_\_filename和\_\_dirname等全局变量。</div>

<h4 id="1-0-global全局对象"><a href="#1-0-global全局对象" class="headerlink" title="1.0 global全局对象"></a>1.0 global全局对象</h4><p>在Node中定义了一个<code>global</code>对象，代表全局命名空间，所有的全局变量、函数或对象都作为<code>global全局对象</code>的成员。我们可以在<a target="_blank" rel="noopener" href="http://wendingding.com/2018/11/27/Node%E7%B3%BB%E5%88%97-PRPL/">REPL环境</a>中直接通过变量来进行查看，下面列出核心成员(细节有省略)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node</span><br><span class="line">&gt; <span class="built_in">global</span></span><br><span class="line">&#123; <span class="attr">console</span>: [Getter],</span><br><span class="line">  <span class="attr">DTRACE_NET_SERVER_CONNECTION</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">DTRACE_NET_STREAM_END</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">DTRACE_HTTP_SERVER_REQUEST</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">DTRACE_HTTP_SERVER_RESPONSE</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">DTRACE_HTTP_CLIENT_REQUEST</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">DTRACE_HTTP_CLIENT_RESPONSE</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">global</span>: [Circular],</span><br><span class="line">  <span class="attr">process</span>: </span><br><span class="line">    process &#123; ···省略··· &#125;,</span><br><span class="line">  <span class="attr">Buffer</span>: &#123; ···省略··· &#125;,</span><br><span class="line">  <span class="attr">clearImmediate</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">clearInterval</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">clearTimeout</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">setImmediate</span>: &#123; [<span class="built_in">Function</span>: setImmediate] [<span class="built_in">Symbol</span>(util.promisify.custom)]: [<span class="built_in">Function</span>] &#125;,</span><br><span class="line">  <span class="attr">setInterval</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">setTimeout</span>: &#123; [<span class="built_in">Function</span>: <span class="built_in">setTimeout</span>] [<span class="built_in">Symbol</span>(util.promisify.custom)]: [<span class="built_in">Function</span>] &#125;,</span><br><span class="line">  <span class="attr">module</span>: </span><br><span class="line">    Module &#123; ···省略··· &#125;,</span><br><span class="line">  <span class="attr">require</span>: &#123; ···省略··· &#125;</span><br></pre></td></tr></table></figure>
<p>通过打印输出我们发现，<code>global全局对象</code>中包含很多的成员，比如用于控制台输出的console对象、处理底层网络请求的一系列函数以及相对复杂的process对象等，这里先给出整体结构图然后再分别介绍。</p>
<img src='../../../../src/node_global.png'>

<p>下面列出的是全局对象跟网络连接相关的一系列方法(这里不做深入)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DTRACE_NET_STREAM_END: [<span class="built_in">Function</span>],</span><br><span class="line"><span class="attr">DTRACE_NET_SERVER_CONNECTION</span>: [<span class="built_in">Function</span>],</span><br><span class="line"><span class="attr">DTRACE_HTTP_SERVER_REQUEST</span>: [<span class="built_in">Function</span>],</span><br><span class="line"><span class="attr">DTRACE_HTTP_SERVER_RESPONSE</span>: [<span class="built_in">Function</span>],</span><br><span class="line"><span class="attr">DTRACE_HTTP_CLIENT_REQUEST</span>: [<span class="built_in">Function</span>],</span><br><span class="line"><span class="attr">DTRACE_HTTP_CLIENT_RESPONSE</span>: [<span class="built_in">Function</span>],</span><br></pre></td></tr></table></figure>
<p>在<code>global全局对象</code>中有一个<code>global</code>属性，该属性指向的是自身，而且全局对象中所有的成员都可以直接通过成员的名称来进行访问(这点跟前端开发中的<code>window</code>对象类似)，下面给出简单示例代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node</span><br><span class="line">&gt; <span class="built_in">global</span>.global == <span class="built_in">global</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; <span class="built_in">global</span> == <span class="built_in">this</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; <span class="built_in">global</span>.module</span><br><span class="line">Module &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;&lt;repl&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">exports</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">parent</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="attr">filename</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">children</span>: [],</span><br><span class="line">  <span class="attr">paths</span>: </span><br><span class="line">   [ <span class="string">&#x27;/Users/文顶顶/Desktop/global/repl/node_modules&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/Users/文顶顶/Desktop/global/node_modules&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/Users/文顶顶/Desktop/node_modules&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/Users/文顶顶/node_modules&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/Users/node_modules&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/node_modules&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/Users/文顶顶/.node_modules&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/Users/文顶顶/.node_libraries&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/usr/local/lib/node&#x27;</span> ] &#125;</span><br><span class="line">&gt; <span class="built_in">module</span>.id</span><br><span class="line"><span class="string">&#x27;&lt;repl&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-0-Console控制台输出"><a href="#2-0-Console控制台输出" class="headerlink" title="2.0 Console控制台输出"></a>2.0 Console控制台输出</h4><p><code>Console</code>对象主要用于控制台输出，该对象中拥有诸多方法，作用各异但差别不大。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node</span><br><span class="line">&gt; <span class="built_in">console</span>.log(<span class="built_in">console</span>)</span><br><span class="line">Console &#123;</span><br><span class="line">  <span class="attr">log</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">info</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">warn</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">error</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">dir</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">time</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">timeEnd</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">clear</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">group</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">groupCollapsed</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">groupEnd</span>: [<span class="built_in">Function</span>: bound consoleCall],</span><br><span class="line">  <span class="attr">Console</span>: [<span class="built_in">Function</span>: Console],</span><br><span class="line">  ···省略···</span><br><span class="line">  <span class="attr">context</span>: [<span class="built_in">Function</span>: context],</span><br><span class="line">  [<span class="built_in">Symbol</span>(counts)]: <span class="built_in">Map</span> &#123;&#125; &#125;</span><br></pre></td></tr></table></figure>
<p>我们在开发中使用控制台输出常用的是<code>Console.log</code>方法，该方法用于进行标准输出流的输出，也就是在控制台中打印和显示N行字符串信息，使用方式非常简单而且灵活。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;001 我是字符串&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;002 我是需要传递参数的字符串，参数为%s&quot;</span>,<span class="string">&quot; XXX&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;002 我是需要传递参数的字符串，参数为%s&quot;</span>,<span class="string">&quot; XXX&quot;</span>,<span class="string">&quot;and Other&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;003 控制输出数字=&gt; %d&quot;</span>,<span class="number">10.123</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;003 控制输出符号=&gt; %%&quot;</span>,<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;004 控制输出简单计算的结果=&gt; &quot;</span>,<span class="number">3</span> + <span class="number">3</span>);</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>,b = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a == b);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.info(<span class="string">&quot;005 我也是字符串&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>列出上面代码的输出。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node Console.js </span><br><span class="line">001 我是字符串</span><br><span class="line">002 我是需要传递参数的字符串，参数为 XXX</span><br><span class="line">002 我是需要传递参数的字符串，参数为 XXX and Other</span><br><span class="line">003 控制输出数字=&gt; 10.123</span><br><span class="line">003 控制输出符号=&gt; % 30</span><br><span class="line">004 控制输出简单计算的结果=&gt;  6</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">005 我也是字符串</span><br><span class="line">wendingding$ node Console.js &gt; log.text</span><br></pre></td></tr></table></figure>
<p><code>console</code>对象的<code>log、info、error、warn</code>方法在使用上几乎没有任何的差别，而且都支持对输出流进行重定向操作(<code>使用&gt;符号</code>)，而<code>dir</code>方法则可以查看并打印对象的详细内容，在需要查看对象或函数细节的时候会比较有用，下面给出简单示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//语法  console.dir(obj , [ options ] )</span></span><br><span class="line"><span class="comment">//参数</span></span><br><span class="line"><span class="comment">//obj               要打印的目标对象</span></span><br><span class="line"><span class="comment">//options           用来控制打印的可选配置对象，主要配置项如下</span></span><br><span class="line"><span class="comment">//[1]  colors:      布尔类型值，输出的信息是否有颜色</span></span><br><span class="line"><span class="comment">//[2]  depth:       告诉内部的util.inspect()格式化对象时要递归多少次，默认为2，null则无限递归</span></span><br><span class="line"><span class="comment">//[3]  showHidden   设置为true则显示不可枚举属性和 symbol 属性。</span></span><br><span class="line">wendingding$ node</span><br><span class="line">&gt; <span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">&quot;zs&quot;</span>,<span class="attr">show</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="built_in">this</span>.name)&#125;&#125;;</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line">&gt; obj</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">show</span>: [<span class="built_in">Function</span>: show] &#125;</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">console</span>.dir(obj,&#123;<span class="attr">showHidden</span>:<span class="literal">true</span>,<span class="attr">depth</span>:<span class="number">1</span>&#125;)</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  <span class="attr">show</span>: </span><br><span class="line">   &#123; [<span class="built_in">Function</span>: show]</span><br><span class="line">     [length]: <span class="number">0</span>,</span><br><span class="line">     [name]: <span class="string">&#x27;show&#x27;</span>,</span><br><span class="line">     [<span class="built_in">arguments</span>]: <span class="literal">null</span>,</span><br><span class="line">     [caller]: <span class="literal">null</span>,</span><br><span class="line">     [prototype]: show &#123; [<span class="title">constructor</span>]: [<span class="title">Circular</span>] &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>
<p><code>console.time()和console.endTime()</code>方法用以计算一个操作的持续时间，两个方法需要配对使用，它们接收同一个字符串作为参数以标记开始和结束时间线，下面给出简短示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开始计时(任务标记为for-10000)</span></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;for-10000&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;<span class="number">10000</span>;i++)&#123;&#125;</span><br><span class="line"><span class="comment">//结束计时</span></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&quot;for-10000&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//REPL环境中执行代码：</span></span><br><span class="line">wendingding$ node Console.js </span><br><span class="line"><span class="keyword">for</span>-<span class="number">10000</span>: <span class="number">0.</span>209ms</span><br></pre></td></tr></table></figure>
<p><code>console.group()和console.groupEnd()</code>方法用来设置后面的输出缩进增加或减少两个空格，在8.5.0版本中新增的<code>groupCollapsed</code>方法是<code>group</code>方法的别名，另外<code>clear</code>方法用来清空控制台消息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bogon:fs wendingding$ node</span><br><span class="line">&gt;  <span class="built_in">console</span>.log(<span class="string">&quot;参照字符串&quot;</span>);</span><br><span class="line">参照字符串</span><br><span class="line">&gt; <span class="built_in">console</span>.group(<span class="string">&quot;将后续行的缩进增加两个空格&quot;</span>)</span><br><span class="line">将后续行的缩进增加两个空格</span><br><span class="line">&gt;  <span class="built_in">console</span>.log(<span class="string">&quot;参照字符串&quot;</span>);</span><br><span class="line">  参照字符串</span><br><span class="line">&gt; <span class="built_in">console</span>.groupEnd(<span class="string">&quot;将后续行的缩进减少两个空格&quot;</span>)</span><br><span class="line">&gt;  <span class="built_in">console</span>.log(<span class="string">&quot;参照字符串&quot;</span>);</span><br><span class="line">参照字符串</span><br><span class="line">&gt;<span class="built_in">console</span>.clear();</span><br></pre></td></tr></table></figure>
<p>除了全局的 console 实例外，console对象(模块)还在内部提供了<a target="_blank" rel="noopener" href="http://nodejs.cn/api/console.html#console_new_console_options">Console 类</a>可用来创建一个具有可配置的输出流的简单记录器，代码中通过<code>require(&quot;console&quot;).Console</code>或 <code>console.Console</code>使用，具体的使用方式请参考官方文档，这里简单列出该类的结构。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node</span><br><span class="line">&gt; <span class="built_in">console</span>.dir(<span class="built_in">console</span>.Console,&#123;<span class="attr">depth</span>:<span class="number">1</span>,<span class="attr">showHidden</span>:<span class="literal">true</span>&#125;)</span><br><span class="line">&#123; [<span class="built_in">Function</span>: Console]</span><br><span class="line">  [length]: <span class="number">2</span>,</span><br><span class="line">  [name]: <span class="string">&#x27;Console&#x27;</span>,</span><br><span class="line">  [prototype]: </span><br><span class="line">   Console &#123;</span><br><span class="line">     [<span class="title">constructor</span>]: [<span class="title">Circular</span>],</span><br><span class="line">     <span class="title">log</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">info</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">warn</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">error</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">dir</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">time</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">timeEnd</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">trace</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">assert</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">clear</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">count</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">countReset</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">group</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">groupCollapsed</span>: [<span class="title">Object</span>],</span><br><span class="line">     <span class="title">groupEnd</span>: [<span class="title">Object</span>] &#125; &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-0-定时器相关方法"><a href="#3-0-定时器相关方法" class="headerlink" title="3.0 定时器相关方法"></a>3.0 定时器相关方法</h4><p>Node中的<code>timer模块</code>提供了全局的定时器API，这些方法的作用和Web浏览器提供的定时器方法类似。<br><span style='color:red'>在实现上，Node中的定时器方法基于Node事件循环来进行构建</span>。</p>
<blockquote>
<p><strong>定时器相关方法·语法介绍</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(callback[, ...args])            预定立即执行的回调函数，它在I/O事件回调之后被触发</span><br><span class="line"><span class="built_in">setInterval</span>(callback, delay[, ...args])      每间隔固定时间就执行一次回调函数</span><br><span class="line"><span class="built_in">setTimeout</span>(callback, delay[, ...args])       固定时间后执行一次回调函数</span><br><span class="line">clearImmediate(immediate)</span><br><span class="line"><span class="built_in">clearInterval</span>(timeout)                       取消定时器</span><br><span class="line"><span class="built_in">clearTimeout</span>(timeout)                        取消定时器</span><br></pre></td></tr></table></figure>

<p>在上面列出的这些方法中，<code>callback</code>均表示回调函数，如果该参数不是函数类型，那么在执行代码的时候将抛出<a href="">TypeError</a>。<code>delay</code>表示时间(计量单位为毫秒)，需注意delay的取值范围为<a href="">1~2147483647</a>，如果超出该范围那么delay的值将会会被设为 1。<code>args</code>表示的是当调用回调函数时传递给回调函数的实际参数，需注意<code>args</code>的传参格式是参数列表而非数组。</p>
<p><code>clearxxx</code>系列方法均用来取消定时器，这些函数接收一个<code>timeout</code>类型的实例对象(该类型的实例对象是内部创建的，作为<code>setTimeout()</code> 或 <code>setInterval()</code> 的返回值)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//001 开启定时器</span></span><br><span class="line"><span class="comment">//2秒后执行回调函数，10和20作为回调函数的参数</span></span><br><span class="line"><span class="keyword">var</span> timer1 = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;setTimeout方法=&gt;%d&quot;</span>,(a +b));</span><br><span class="line">&#125;,<span class="number">2000</span>,<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//002 开启定时器</span></span><br><span class="line"><span class="comment">//每隔1秒就执行一次回调函数，Nice作为回调函数的参数</span></span><br><span class="line"><span class="keyword">var</span> timer2 = <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params">param</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;setInterval=&gt;参数：&quot;</span>,param);</span><br><span class="line">&#125;,<span class="number">1000</span>,<span class="string">&quot;Nice!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//003 取消定时器</span></span><br><span class="line"><span class="comment">//5秒之后执行回调函数，取消time2定时器</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;取消定时器timer2&quot;</span>);</span><br><span class="line">  <span class="built_in">clearInterval</span>(timer2)</span><br><span class="line">&#125;,<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//timer2.unref()</span></span><br><span class="line"><span class="comment">//当调用该方法时，活动的定时器对象对象不要求 Node.js 事件循环保持活动。 </span></span><br><span class="line"><span class="comment">//如果没有其他活动保持事件循环运行，则进程可能在定时器对象的回调函数被调用之前退出。</span></span><br><span class="line"><span class="comment">//注意：多次调用定时器对象的unref() 方法没有效果。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//timer2.ref()</span></span><br><span class="line"><span class="comment">//当调用该方法时，只要定时器对象处于活动状态就要求Node事件循环不要退出。 </span></span><br><span class="line"><span class="comment">//注意：多次调用定时器对象的ref()方法没有效果。</span></span><br><span class="line"><span class="comment">//注意：默认所有的定时器对象都是&quot;ref&quot;的，通常不需要调用ref()方法，除非之前调用了unref()。</span></span><br></pre></td></tr></table></figure>
<p><strong>说明</strong> 定时器对象的<code>unref</code>方法能够取消回调函数的调用。当指定定时器实例对象的回调函数被取消后，可以通过对应的<code>ref</code>方法来恢复调用，下面列出代码的执行情况：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node timer.js </span><br><span class="line"><span class="built_in">setInterval</span>=&gt;参数： Nice!</span><br><span class="line"><span class="built_in">setTimeout</span>方法=&gt;<span class="number">30</span></span><br><span class="line"><span class="built_in">setInterval</span>=&gt;参数： Nice!</span><br><span class="line"><span class="function"><span class="params">setInterval</span>=&gt;</span>参数： Nice!</span><br><span class="line"><span class="function"><span class="params">setInterval</span>=&gt;</span>参数： Nice!</span><br><span class="line">取消定时器timer2</span><br></pre></td></tr></table></figure>

<h4 id="4-0-filename和-dirname"><a href="#4-0-filename和-dirname" class="headerlink" title="4.0 __filename和__dirname"></a>4.0 __filename和__dirname</h4><p><code>__filename</code>和<code>__dirname</code>是Node中预定义的两个变量，分别用来获取当前模块的文件名(全路径)以及当前的目录名，这两个变量在任何模块文件的内部均可使用。</p>
<blockquote>
<p>❏  <strong>__filename</strong> 获取当前模块文件的完整绝对路径(文件名)<br>❏  <strong>__dirname</strong>  获取当前模块所在目录的完整绝对路径(目录名)</p>
</blockquote>
<p>我们可以在JavaScript文件中打印<code>__filename</code>和<code>__dirname</code>变量，然后运行查看结果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备注：在timer.js文件中打印变量</span></span><br><span class="line"><span class="built_in">console</span>.log(__dirname);</span><br><span class="line"><span class="built_in">console</span>.log(__filename);</span><br><span class="line"></span><br><span class="line"><span class="comment">//REPL环境执行timer.js文件结果</span></span><br><span class="line">wendingding$ node timer.js </span><br><span class="line">/Users/文顶顶/Desktop/fs</span><br><span class="line">/Users/文顶顶/Desktop/fs/timer.js</span><br></pre></td></tr></table></figure>

<img src='../../../../z.png' width="200px">

<hr>
<ul>
<li>Posted by 博客园·<a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a> | <a target="_blank" rel="noopener" href="http://wendingding.com/">花田半亩</a></li>
<li>联系作者 简书·<a target="_blank" rel="noopener" href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/12/05/Node%E7%B3%BB%E5%88%97-require/" class="prev">上一篇</a><a href="/2018/12/01/Node%E7%B3%BB%E5%88%97-fs/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 422k (字)</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>