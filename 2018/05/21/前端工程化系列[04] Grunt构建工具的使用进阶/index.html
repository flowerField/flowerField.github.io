<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 前端工程化系列[04]-Grunt构建工具的使用进阶 · 花田半亩</title><meta name="description" content="前端工程化系列[04]-Grunt构建工具的使用进阶 - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="花田半亩" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="https://github.com/flowerField" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">前端工程化系列[04]-Grunt构建工具的使用进阶</h1><div class="post-info">May 21, 2018<span class="post-count"></span> ✧ 字数统计:5.5k(字) &nbsp;&nbsp; ♨︎ 阅读时长:23(分钟)</div><div class="post-content"><blockquote>
<p>在<a target="_blank" rel="noopener" href="http://wendingding.com/2018/05/18/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%B3%BB%E5%88%97[02]%20Grunt%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/">前端工程化系列[02]-Grunt构建工具的基本使用</a>和<a target="_blank" rel="noopener" href="http://wendingding.com/2018/05/20/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%B3%BB%E5%88%97[03]%20Grunt%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%9B%E9%98%B6/">前端工程化系列[03]-Grunt构建工具的运转机制</a>这两篇文章中，我们对Grunt以及Grunt插件的使用已经有了初步的认识，并探讨了Grunt的主要组件以及它的运转机制，这篇文章是Grunt使用的进阶教程，主要输出以下内容：</p>
</blockquote>
<blockquote>
<p>❏ &nbsp;<span style='color:#f25'>Grunt项目的自定义任务</span><br>❏ &nbsp;<span style='color:#f25'>Grunt任务的描述和依赖</span><br>❏ &nbsp;<span style='color:#f25'>Grunt多目标任务和选项</span><br>❏ &nbsp;<span style='color:#f25'>Grunt项目任务模板配置</span><br>❏ &nbsp;<span style='color:#f25'>Grunt自动化构建和监听</span></p>
</blockquote>
<h3 id="3-1-Grunt自定义任务"><a href="#3-1-Grunt自定义任务" class="headerlink" title="3.1 Grunt自定义任务"></a>3.1 Grunt自定义任务</h3><p>在使用Grunt的时候，可以先到Grunt官网的插件列表搜索是否有适合自己项目的Grunt插件，如果有那么建议直接使用，如果没有那么开发者可以尝试自定义任务或者是自己创建对应的插件。Grunt的插件其实就是一些封装好的任务(Task)，没有什么稀奇的，Grunt支持自定义任务，而且方式非常简单。</p>
<p>如果我们需要定义一个任务，向控制台里输出字符串信息，那么在package.json文件、Gruntfile文件已经创建且grunt本地依赖已安装的前提下，如下编辑Gruntfile文件即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包装函数</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(1)自定义任务(一)</span></span><br><span class="line">    <span class="comment">//向控制台输出:hello 文顶顶</span></span><br><span class="line">    <span class="comment">//第一个参数:任务的名称(Task)</span></span><br><span class="line">    <span class="comment">//第二个参数:具体的任务内容</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;hello&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;hello 文顶顶&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2)自定义任务(二)</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;football&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;皇家马德里: how are you!&quot;</span>);</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;尤文图斯: how old are you！&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>终端输入命令执行任务，可以单个执行，也可以一起执行，下面给出具体执行情况</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wendingding:02-Grunt_Test wendingding$ grunt hello</span><br><span class="line">Running &quot;hello&quot; task</span><br><span class="line">hello 文顶顶</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line">wendingding:02-Grunt_Test wendingding$ grunt football</span><br><span class="line">Running &quot;football&quot; task</span><br><span class="line">皇家马德里: how are you!</span><br><span class="line">尤文图斯: how old are you！</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line">wendingding:02-Grunt_Test wendingding$ grunt hello football</span><br><span class="line">Running &quot;hello&quot; task</span><br><span class="line">hello 文顶顶</span><br><span class="line"></span><br><span class="line">Running &quot;football&quot; task</span><br><span class="line">皇家马德里: how are you!</span><br><span class="line">尤文图斯: how old are you！</span><br><span class="line"></span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>
<p>通过上面的代码我们可以看到，<span style='color:red'>自定义任务非常简单，只需要调用grunt对象的registerTask方法即可，其中第一个参数是Task的名称，第二个参数是回调函数用来存放具体的任务（比如这里是打印输出）。</span></p>
<div class='tip'>在自定义任务中，我们用到了grunt.log.writeln函数，这是Grunt提供的众多内置方法之一，作用是向控制台输出消息并换行。同类型的方法还有grunt.log.error()、grunt.log.subhead()等方法，大家可以到[官网API文档](https://gruntjs.com/api/grunt.log)自行查看。</div>

<p>Grunt项目在具体使用的时候，通常是自定义Task + Grunt插件相结合的形式，我们来看下面这段代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包装函数</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(1)自定义任务(一) 任务名称 hello</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;hello&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;hello 文顶顶&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2)自定义任务(二) 任务名称 football</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;football&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;皇家马德里: how are you!&quot;</span>);</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;尤文图斯: how old are you！&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2) 插件的处理</span></span><br><span class="line">    <span class="comment">//使用步骤:</span></span><br><span class="line">    <span class="comment">//[1] 先把对应的插件下载和安装到本地的项目中 $ npm install grunt-contrib-concat --save-dev</span></span><br><span class="line">    <span class="comment">//[2] 对插件(任务)进行配置 grunt.initConfig</span></span><br><span class="line">    <span class="comment">//[3] 加载对应的插件 loadNpmTasks</span></span><br><span class="line">    <span class="comment">//[4] 注册任务      grunt.registerTask</span></span><br><span class="line">    <span class="comment">//[5] 通过grunt命令执行任务</span></span><br><span class="line">    <span class="comment">//配置插件相关信息</span></span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">        <span class="string">&quot;concat&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;dist&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;src&quot;</span>:[<span class="string">&quot;src/demo_one.js&quot;</span>,<span class="string">&quot;src/demo_two.js&quot;</span>,<span class="string">&quot;src/demo_three.js&quot;</span>],</span><br><span class="line">                <span class="string">&quot;dest&quot;</span>:<span class="string">&quot;dist/index.js&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载插件</span></span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-concat&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册任务（一）：把hello \ football \ concat 这三个Task注册为default的Task</span></span><br><span class="line">    <span class="comment">//当执行$ grunt 或者是$ grunt default的时候，会顺序执行者三个任务！</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;default&quot;</span>,[<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;football&quot;</span>,<span class="string">&quot;concat&quot;</span>]);</span><br><span class="line">    <span class="comment">//注册任务(二)</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;customTask&quot;</span>,[<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;football&quot;</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>对于上面的Gruntfile文件，如果在终端输入<code>$ grunt</code>或者<code>$ grunt default</code> 命令则依次执行hello football和concat三个任务，输入<code>$ grunt customTask</code>则一次执行hello football 自定义任务。</p>
<h3 id="3-2-任务描述和依赖"><a href="#3-2-任务描述和依赖" class="headerlink" title="3.2 任务描述和依赖"></a>3.2 任务描述和依赖</h3><p><strong>设置任务描述</strong></p>
<p>随着项目复杂性的增加，Grunt任务也会越来越多，而任务(Task)的可用性、用途以及调用方法可能会变得难以追踪。所幸，我们可以通过给任务设定相应的描述信息来解决这些问题。</p>
<p>要给任务设置描述信息非常简单，只需要在调用registerTask方法的时候多传递一个参数即可（作为第二个参数传递），我们可以把一个具体的字符串描述信息作为函数的参数传递。</p>
<p>这里，我们修改上面示例代码中football任务部分的代码，并任务设置描述信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grunt.registerTask(<span class="string">&quot;football&quot;</span>,<span class="string">&quot;17-18赛季 欧冠八分之一决赛抽签场景&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;皇家马德里: how are you!&quot;</span>);</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;尤文图斯: how old are you！&quot;</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>此时，在终端中输入<code>$ grunt --help</code>命令就能够看到当前Grunt项目中可用的Task，以及相应的描述信息了，关键信息如下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Available tasks</span><br><span class="line">         hello  Custom task.</span><br><span class="line">      football  17-18赛季 欧冠八分之一决赛抽签场景</span><br><span class="line">        concat  Concatenate files. *</span><br><span class="line">       default  Alias for &quot;hello&quot;, &quot;football&quot;, &quot;concat&quot; tasks.</span><br><span class="line">    customTask  Alias for &quot;hello&quot;, &quot;football&quot; tasks.</span><br></pre></td></tr></table></figure>
<p><strong>任务依赖</strong></p>
<p>在复杂的Grunt工作流程中，很多任务之间往往存在依赖关系，比如js代码的语法检查和压缩这两个任务，压缩任务需要依赖于语法检查任务，它们在执行的时候存在一定的先后关系，这种情况我们称之为任务依赖。</p>
<p>我们可以在注册任务的时候，刻意指定这种依赖关系，他们更多的是以一种特定的先后顺序执行。<span style='color:red'>如果是自定义任务，也可以通过grunt.task.requires()方法来设定这种任务间的依赖关系。</span></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//注册两个自定义任务</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 第一个参数:Task的名称</span></span><br><span class="line"><span class="comment">    * 第二个参数:任务的描述信息</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;hi&quot;</span>,<span class="string">&quot;描述信息:这是一个打招呼的任务&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        grunt.log.ok(<span class="string">&quot;hi 文顶顶&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;任务的描述次信息:这是一个简单问候任务&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//设置任务依赖：表明当前的任务在执行的时候需要依赖于另外一个任务</span></span><br><span class="line">        <span class="comment">//必须先执行hi这个任务,才能执行hello这个任务</span></span><br><span class="line">        grunt.task.requires(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Nice to meet you!&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面的代码中定义了hi和hello两个任务，其中hello这个Task需要依赖于hi的执行，如果直接执行hello，那么会打印任务依赖的提示信息，具体的执行情况如下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wendingding:05-Grunt项目任务的描述和依赖 wendingding$ grunt hello</span><br><span class="line">Running &quot;hello&quot; task</span><br><span class="line">Warning: Required task &quot;hi&quot; must be run first. Use --force to continue.</span><br><span class="line"></span><br><span class="line">Aborted due to warnings.</span><br><span class="line">wendingding:05-Grunt项目任务的描述和依赖 wendingding$ grunt hi hello</span><br><span class="line">Running &quot;hi&quot; task</span><br><span class="line">&gt;&gt; hi 文顶顶</span><br><span class="line"></span><br><span class="line">Running &quot;hello&quot; task</span><br><span class="line">Nice to meet you!</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<h3 id="3-3-Grunt多目标任务和Options选项"><a href="#3-3-Grunt多目标任务和Options选项" class="headerlink" title="3.3 Grunt多目标任务和Options选项"></a>3.3 Grunt多目标任务和Options选项</h3><p><strong>理解多目标Task</strong></p>
<p>Grunt中的多目标任务（multi-task）是相对于基本任务而言的，多目标任务几乎是Grunt中最复杂的概念。它的使用方式非常灵活，其设计的目的是可以在当个项目中支持多个Targets目标[<code>可以认为是多种配置</code>]。当任务在执行的时候，可以一次性执行全部的Target也可以指定某一特定的Target执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//(1) 配置Task，给Task设置多个Target</span></span><br><span class="line">    grunt.config(<span class="string">&quot;hello&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;targetA&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;des&quot;</span>:<span class="string">&quot;Nice to meet you!&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;targetB&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;des&quot;</span>:<span class="string">&quot;how are you?&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2) 自定义任务 任务的名称为hello</span></span><br><span class="line">    <span class="comment">//第一个参数：Task名称</span></span><br><span class="line">    <span class="comment">//第二个参数：任务的描述信息</span></span><br><span class="line">    <span class="comment">//第三个参数：具体要执行的任务</span></span><br><span class="line">   grunt.registerMultiTask(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;描述信息:打招呼&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        grunt.log.ok(<span class="string">&quot;hello 文顶顶&quot;</span>);</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;this.target:&quot;</span>,<span class="built_in">this</span>.target);</span><br><span class="line">        grunt.log.writeln(<span class="string">&quot;this.data:&quot;</span>,<span class="built_in">this</span>.data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>代码说明</strong></p>
<p>通过观察可以发现，我们通过<code>grunt.registerMultiTask方法</code>创建了支持多任务（Target）操作的自定义任务hello，主要任务就是输出<span style='color:#f22'>“hello 文顶顶”</span>消息以及打印当前的target和data值。然后通过<code>grunt.config方法</code>来给hello这个Task设定了两个Target，分别是targetA和targetB。</p>
<p>在上面的代码中，我们引用了this.target和this.data这两个属性，<span style='color:#f22'>回调函数中的this指向的是当前正在运行的目标对象。</span>执行targetA这个选项的时候，打印的this对象如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">nameArgs</span>: <span class="string">&#x27;hello:targetA&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="attr">args</span>: [],</span><br><span class="line">  <span class="attr">flags</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">async</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">errorCount</span>: [Getter],</span><br><span class="line">  <span class="attr">requires</span>: [<span class="built_in">Function</span>: bound ],</span><br><span class="line">  <span class="attr">requiresConfig</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">options</span>: [<span class="built_in">Function</span>],</span><br><span class="line">  <span class="attr">target</span>: <span class="string">&#x27;targetA&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123; <span class="attr">des</span>: <span class="string">&#x27;Nice to meet you!&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">files</span>: [],</span><br><span class="line">  <span class="attr">filesSrc</span>: [Getter] &#125;</span><br></pre></td></tr></table></figure>

<p>目前为止，我们一直在谈论Task（任务）和Target（目标），大家可能懵逼了，不禁要问<code>它们之间到底是什么关系？</code></p>
<p>私以为可以简单的类比一下，假设现在有一个任务就是中午吃大餐，而具体吃什么大餐，可以灵活安排多个方案进行选择，比如方案A吃西餐，方案B吃中餐，方案C吃日本料理。等我们真正到了餐馆要开吃的时候，可以选择方案A吃西餐或者是方案B吃中餐，甚至中餐、西餐和日本料理全端上桌也未尝不可。</p>
<p><span style='color:#f22'>Task指的是整个任务，在这个例子中就是要吃大餐，Target指的是任务中的某一种可行方案，也就是方案A、方案B和方案C，吃大餐这个Task中我们配置了三个Target。定义任务的目的是为了执行，在执行Task的时候，我们可以选择执行某个或某几个指定的Target(目标)，这样的处理方式无疑更强大而且操作起来更加的灵活。</span></p>
<p><strong>多目标任务的执行</strong></p>
<p>运行多目标Task的时候，有多种方式选择。</p>
<p>① 让Task按照指定的target运行。<code>$ grunt TaskName:targetName</code></p>
<p>② 让Task把所有的target都运行一次。<code>$ grunt TaskName</code></p>
<p>下面列出示例代码的具体执行情况</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">wendingding:05-Grunt项目任务的描述和依赖 wendingding$ grunt hello</span><br><span class="line">Running &quot;hello:targetA&quot; (hello) task</span><br><span class="line">&gt;&gt; hello 文顶顶</span><br><span class="line">this.target: targetA</span><br><span class="line">this.data: &#123; des: &#x27;Nice to meet you!&#x27; &#125;</span><br><span class="line"></span><br><span class="line">Running &quot;hello:targetB&quot; (hello) task</span><br><span class="line">&gt;&gt; hello 文顶顶</span><br><span class="line">this.target: targetB</span><br><span class="line">this.data: &#123; des: &#x27;how are you?&#x27; &#125;</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line">wendingding:05-Grunt项目任务的描述和依赖 wendingding$ grunt hello:targetA</span><br><span class="line">Running &quot;hello:targetA&quot; (hello) task</span><br><span class="line">&gt;&gt; hello 文顶顶</span><br><span class="line">this.target: targetA</span><br><span class="line">this.data: &#123; des: &#x27;Nice to meet you!&#x27; &#125;</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line">wendingding:05-Grunt项目任务的描述和依赖 wendingding$ grunt hello:targetB</span><br><span class="line">Running &quot;hello:targetB&quot; (hello) task</span><br><span class="line">&gt;&gt; hello 文顶顶</span><br><span class="line">this.target: targetB</span><br><span class="line">this.data: &#123; des: &#x27;how are you?&#x27; &#125;</span><br><span class="line"></span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<div class='tip'>如果在Gruntfile文件中，调用了`grunt.registerTask方法`来注册自定义任务，那么可以通过`TaskName:targetName`的来方式直接指定任务的Target</div>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册任务 [给hello起一个别名]</span></span><br><span class="line"> grunt.registerTask(<span class="string">&quot;helloTargetA&quot;</span>,[<span class="string">&quot;hello:targetA&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>在终端中，输入<code>$ grunt helloTargetA</code>命令将会执行hello这个Task中的targetA选项。</p>
<p><strong>多目标任务的Options选项</strong></p>
<p>在对多目标的任务进行配置的时候，任何存储在options选项下面的数据都会被特殊的处理。</p>
<p>下面列出一份Gruntfile文件中的核心代码，并以多种方式执行，通过这份代码能够帮助我们理解多目标任务的Options选项配置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包装函数</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(1) 配置Task相关信息</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 第一个参数:Task的名称</span></span><br><span class="line"><span class="comment">    * 第二个参数:任务的描述信息</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">       <span class="string">&quot;hi&quot;</span>: &#123;</span><br><span class="line">           <span class="comment">/*对整个任务中所有target的配置项 全局配置*/</span></span><br><span class="line">           <span class="attr">options</span>:&#123;</span><br><span class="line">               <span class="string">&quot;outPut&quot;</span>:<span class="string">&quot;array&quot;</span></span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">targetA</span>:&#123;</span><br><span class="line">               <span class="attr">arrM</span>:[<span class="string">&quot;targetA_1&quot;</span>,<span class="string">&quot;targetA_2&quot;</span>,<span class="string">&quot;targetA_3&quot;</span>]</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">targetB</span>:&#123;</span><br><span class="line">               <span class="attr">options</span>:&#123;</span><br><span class="line">                   <span class="string">&quot;outPut&quot;</span>:<span class="string">&quot;json&quot;</span></span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">arrM</span>:[<span class="string">&quot;targetB_1&quot;</span>,<span class="string">&quot;targetB_2&quot;</span>,<span class="string">&quot;targetB_3&quot;</span>]</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">targetC</span>:&#123;</span><br><span class="line">               <span class="attr">arrM</span>:[<span class="string">&quot;targetC_1&quot;</span>,<span class="string">&quot;targetC_2&quot;</span>,<span class="string">&quot;targetC_3&quot;</span>]</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2) 自定义任务 Task名称为hi</span></span><br><span class="line">    <span class="comment">//第一个参数：Task名称</span></span><br><span class="line">    <span class="comment">//第二个参数：任务的描述信息</span></span><br><span class="line">    <span class="comment">//第三个参数：具体要执行的任务</span></span><br><span class="line">    grunt.registerMultiTask(<span class="string">&quot;hi&quot;</span>,<span class="string">&quot;描述次信息:这是一个打招呼的任务&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;任务当前执行的target: &quot;</span>+<span class="built_in">this</span>.target);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;任务当前执行的target对应的数据: \n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> objT = <span class="built_in">this</span>.options();</span><br><span class="line">        <span class="keyword">if</span> (objT.outPut === <span class="string">&quot;array&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;输出数组:\n&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.data.arrM);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (objT.outPut === <span class="string">&quot;json&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;输出JSON数据:\n&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.data.arrM));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(1) 相关的概念 Task(任务-hi) | target(目标)</span></span><br><span class="line">    <span class="comment">//(2) 任务的配置:任务中可以配置一个或者是多个目标  调用config</span></span><br><span class="line">    <span class="comment">//(3) 复合任务的执行(多任务-多target)</span></span><br><span class="line">    <span class="comment">//   001 grunt TaskName 把当前Task下面所有的目标操作都执行一遍</span></span><br><span class="line">    <span class="comment">//   002 grunt TaskName:targetName 执行当前Task下面的某一个指定的目标</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;default&quot;</span>,[<span class="string">&quot;hi&quot;</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>具体的执行情况</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">wendingding:06-Grunt项目多任务和options wendingding$ grunt</span><br><span class="line">Running &quot;hi:targetA&quot; (hi) task</span><br><span class="line">任务当前执行的target: targetA</span><br><span class="line">任务当前执行的target对应的数据:</span><br><span class="line"></span><br><span class="line">输出数组:</span><br><span class="line">[ &#x27;targetA_1&#x27;, &#x27;targetA_2&#x27;, &#x27;targetA_3&#x27; ]</span><br><span class="line"></span><br><span class="line">Running &quot;hi:targetB&quot; (hi) task</span><br><span class="line">任务当前执行的target: targetB</span><br><span class="line">任务当前执行的target对应的数据:</span><br><span class="line"></span><br><span class="line">输出JSON数据:</span><br><span class="line">[&quot;targetB_1&quot;,&quot;targetB_2&quot;,&quot;targetB_3&quot;]</span><br><span class="line"></span><br><span class="line">Running &quot;hi:targetC&quot; (hi) task</span><br><span class="line">任务当前执行的target: targetC</span><br><span class="line">任务当前执行的target对应的数据:</span><br><span class="line"></span><br><span class="line">输出数组:</span><br><span class="line">[ &#x27;targetC_1&#x27;, &#x27;targetC_2&#x27;, &#x27;targetC_3&#x27; ]</span><br><span class="line"></span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<p><strong>代码说明</strong></p>
<p>上面的代码中定义了一个多目标任务，Task的名称为<code>hi</code>，该Task有三个target目标选项，分别是<code>targetA、targetB和targetC</code>。在任务配置相关代码中，全局的options配置项中outPut属性对应的值为array，表示具体的目标任务在执行的时候以数组的形式输出。</p>
<p>我们看到在targetB目标中重写了options选项中的outPut属性为json，当终端执行<code>$ grunt</code>命令的时候，会依次执行所有三个target目标选项，而targetA和targetC以数组格式来输出内容，targetB则以json格式来输出内容。</p>
<p><span style='color:#f25'>Grunt多目标任务以及选项使得我们可以针对不同的应用环境，以不同的方式来运行同一个Task。可以利用这一点，我们完全能够定义Task为不同的构建环境创建不同的输出目标。</span></p>
<div class='tip'>说明 ✧ `this.options()方法`用于获取当前正在执行的目标Task的options配置选项</div>

<h3 id="3-4-Grunt项目任务配置模板"><a href="#3-4-Grunt项目任务配置模板" class="headerlink" title="3.4 Grunt项目任务配置模板"></a>3.4 Grunt项目任务配置模板</h3><p><strong>Grunt项目中配置模板的简单使用</strong></p>
<p>在Grunt项目中，我们可以使用<code>&lt;% %&gt;</code>分隔符的方式来指定模板，当Task读取自己配置信息的时候模板的具体内容会自动扩展，且支持以递归的方式展开。</p>
<p>在通过<code>&lt;%= ... %&gt; </code>在向模板绑定数据的时候，我们可以直接传递配置对象中的属性或调用grunt提供的方法，<span style='color:red'>模板中属性的上下文就是当前的配置对象</span>。</p>
<p>下面，我们通过Gruntfile文件中的一段核心代码来展现配置模板的使用情况。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//(1) 创建并设置grunt的配置对象</span></span><br><span class="line">    <span class="comment">//配置对象：该对象将作为参数传递给grunt.config.init方法</span></span><br><span class="line">    <span class="keyword">var</span> configObj = &#123;</span><br><span class="line">        <span class="attr">concat</span>: &#123;</span><br><span class="line">            <span class="attr">target</span>: &#123;</span><br><span class="line">              <span class="comment">//src:[&quot;src/demo1.js&quot;,&quot;src/demo2.js&quot;]</span></span><br><span class="line">                <span class="attr">src</span>: [<span class="string">&#x27;&lt;%= srcPath %&gt;demo1.js&#x27;</span>, <span class="string">&#x27;&lt;%= srcPath %&gt;demo2.js&#x27;</span>],</span><br><span class="line">              <span class="comment">//dest:[&quot;dist/2018_05_21_index.js&quot;]</span></span><br><span class="line">                <span class="attr">dest</span>: <span class="string">&#x27;&lt;%= targetPath %&gt;&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">srcPath</span>:<span class="string">&quot;src/&quot;</span>,</span><br><span class="line">        <span class="attr">destPath</span>:<span class="string">&quot;dist/&quot;</span>,</span><br><span class="line">        <span class="attr">targetPath</span>:<span class="string">&quot;&lt;%= destPath %&gt;&lt;%= grunt.template.today(&#x27;yyyy_mm_dd_&#x27;) %&gt;index.js&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2) 调用init方法对任务(Task)进行配置</span></span><br><span class="line">    <span class="comment">// grunt.config.init 方法 === grunt.initConfig方法</span></span><br><span class="line">    grunt.config.init(configObj);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(3) 加载concat插件</span></span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-concat&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(4) 注册Task</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;default&quot;</span>,[<span class="string">&quot;concat&quot;</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面这段代码对concat插件代码合并Task进行了配置，使用到了模板技术。该任务把src目录下的demo1和demo2两个js文件合并到dist目录下并命名为2018_05_21_index.js文件。</p>
<p><strong>Grunt项目中导入外部的数据</strong></p>
<p>在向模板绑定数据的时候，常见的做法还会导入外部的数据，并把导入的数据设置为配置对象的指定属性值。比如在开发中常常需要用到当前Grunt项目的元信息，包括名称、版本等，这些数据常通过调用<code>grunt.file.readJSON方法</code>加载package.json文件的方式获取。下面给出代码示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包装函数</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置(demoTask和concat)Task的配置信息</span></span><br><span class="line">    grunt.config.init(&#123;</span><br><span class="line">        <span class="comment">//从package.json文件中读取项目的元(基本)信息</span></span><br><span class="line">        <span class="attr">pkg</span>:grunt.file.readJSON(<span class="string">&quot;package.json&quot;</span>),</span><br><span class="line">        <span class="comment">//demoTask的配置信息</span></span><br><span class="line">        <span class="attr">demoTask</span> :&#123;</span><br><span class="line">           <span class="attr">banner</span>:<span class="string">&quot;&lt;%=pkg.name%&gt; -- &lt;%=pkg.version%&gt;&quot;</span></span><br><span class="line">       &#125;,</span><br><span class="line">        <span class="comment">//concat的配置信息</span></span><br><span class="line">        <span class="attr">concat</span>:&#123;</span><br><span class="line">           <span class="attr">options</span>:&#123;</span><br><span class="line">               <span class="attr">stripBanners</span>:<span class="literal">true</span>,</span><br><span class="line">               <span class="attr">banner</span>:<span class="string">&#x27;/*项目名称：&lt;%=pkg.name%&gt; 项目版本：&lt;%=pkg.version%&gt; 项目的作者：&lt;%=pkg.author%&gt; 更新时间：&lt;%=grunt.template.today(&quot;yyyy-mm-dd&quot;)%&gt;*/\n&#x27;</span></span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">target</span>:&#123;</span><br><span class="line">               <span class="attr">src</span>:[<span class="string">&quot;src/demo1.js&quot;</span>,<span class="string">&quot;src/demo2.js&quot;</span>],</span><br><span class="line">               <span class="attr">dest</span>:<span class="string">&#x27;dist/index.js&#x27;</span></span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义Task 任务的名称为demoTask</span></span><br><span class="line">    grunt.registerMultiTask(<span class="string">&quot;demoTask&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;执行demo任务&quot;</span>);</span><br><span class="line">        <span class="comment">//表示调用config方法来读取demoTask里面的banner属性并输出</span></span><br><span class="line">        <span class="built_in">console</span>.log(grunt.config(<span class="string">&quot;demoTask.banner&quot;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从node_modules目录中加载concat插件</span></span><br><span class="line">    <span class="comment">//注意：需要先把插件下载到本地  npm install grunt-contrib-concat --save-dev</span></span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-concat&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册任务</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;default&quot;</span>,[<span class="string">&quot;demoTask&quot;</span>,<span class="string">&quot;concat&quot;</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如果在终端输入<code>$ grunt</code>命令执行，那么demoTask任务将会输出<code>grunt_demo -- 1.0.0</code>打印消息，而concat任务则把两个js文件合并到dist目录下面的index.js文件并添加注释信息。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ grunt</span><br><span class="line">Running &quot;demoTask:banner&quot; (demoTask) task</span><br><span class="line">执行demo任务</span><br><span class="line">grunt_demo -- 1.0.0</span><br><span class="line"></span><br><span class="line">Running &quot;concat:target&quot; (concat) task</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line">wendingding:07-Grunt项目模板配置 wendingding$ cat dist/index.js</span><br><span class="line">/*项目名称：grunt_demo 项目版本：1.0.0 项目的作者：文顶顶 更新时间：2018-05-21*/</span><br><span class="line">console.log(&quot;demo1&quot;);</span><br><span class="line">console.log(&quot;demo2&quot;);</span><br></pre></td></tr></table></figure>

<div class='tip'>
**说明** &nbsp;grunt.file.readJSON方法用于加载JSON数据，grunt.file.readYAML方法用于加载[YAML](http://yaml.org/)数据。</div>

<h3 id="3-5-Grunt自动化构建和监听"><a href="#3-5-Grunt自动化构建和监听" class="headerlink" title="3.5 Grunt自动化构建和监听"></a>3.5 Grunt自动化构建和监听</h3><p>到这里，基本上就可以说已经熟练掌握Grunt了。上文我们在进行代码演示的时候，不论是自定义任务还是Grunt插件使用的讲解都是片段性的，支离破碎的，Grunt作为一款自动化构建工具，<code>自动化</code>这三个字到现在还没有体现出来。</p>
<p>顾名思义，<span style='color:#f25'>自动化构建的意思就是能够监听项目中指定的文件，当这些文件发生改变后自动的来执行某些特定的任务。</span> 否则的话，每次修改文件后，都需要我们在终端里面输入对应的命令来重新执行，这顶多能算<code>半自动化</code>是远远不够的。</p>
<p>下面给出一份更全面些的Gruntfile文件，该文件中使用了几款常用的Grunt插件(uglify、cssmin、concat等)来搭建自动化构建项目的工作流。<a target="_blank" rel="noopener" href="https://github.com/flowerField/ex.git">点击获取演示代码</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包装函数</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 项目配置信息</span></span><br><span class="line">    grunt.config.init(&#123;</span><br><span class="line">        <span class="attr">pkg</span>:grunt.file.readJSON(<span class="string">&quot;package.json&quot;</span>),</span><br><span class="line">        <span class="comment">//代码合并</span></span><br><span class="line">        <span class="attr">concat</span>:&#123;</span><br><span class="line">            <span class="attr">options</span>:&#123;</span><br><span class="line">                <span class="attr">stripBanners</span>:<span class="literal">true</span>,</span><br><span class="line">             <span class="attr">banner</span>:<span class="string">&#x27;/*项目名称：&lt;%=pkg.name%&gt; 项目版本：&lt;%=pkg.version%&gt; 项目的作者：&lt;%=pkg.author%&gt;&#x27;</span></span><br><span class="line">             +<span class="string">&#x27; 更新时间：&lt;%=grunt.template.today(&quot;yyyy-mm-dd&quot;)%&gt;*/\n&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">target</span>:&#123;</span><br><span class="line">                <span class="attr">src</span>:[<span class="string">&quot;src/demo1.js&quot;</span>,<span class="string">&quot;src/demo2.js&quot;</span>],</span><br><span class="line">                <span class="attr">dest</span>:<span class="string">&#x27;dist/index.js&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//js代码压缩</span></span><br><span class="line">        <span class="attr">uglify</span>:&#123;</span><br><span class="line">            <span class="attr">target</span>:&#123;</span><br><span class="line">                <span class="attr">src</span>:<span class="string">&quot;dist/index.js&quot;</span>,</span><br><span class="line">                <span class="attr">dest</span>:<span class="string">&quot;dist/index.min.js&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//css代码压缩</span></span><br><span class="line">        <span class="attr">cssmin</span>:&#123;</span><br><span class="line">            <span class="attr">target</span>:&#123;</span><br><span class="line">                <span class="attr">src</span>:<span class="string">&quot;src/index.css&quot;</span>,</span><br><span class="line">                <span class="attr">dest</span>:<span class="string">&quot;dist/index.min.css&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//js语法检查</span></span><br><span class="line">        <span class="attr">jshint</span>:&#123;</span><br><span class="line">            <span class="attr">target</span>:[<span class="string">&#x27;Gruntfile.js&#x27;</span>,<span class="string">&quot;dist/index.js&quot;</span>],</span><br><span class="line">            <span class="attr">options</span>:&#123;</span><br><span class="line">                <span class="attr">jshintrc</span>:<span class="string">&quot;.jshintrc&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//监听 自动构建</span></span><br><span class="line">        <span class="attr">watch</span>:&#123;</span><br><span class="line">            <span class="attr">target</span>:&#123;</span><br><span class="line">                <span class="attr">files</span>:[<span class="string">&quot;src/*.js&quot;</span>,<span class="string">&quot;src/*.css&quot;</span>],</span><br><span class="line">                <span class="comment">//只要指定路径的文件(js和css)发生了变化，就自动执行tasks中列出的任务</span></span><br><span class="line">                <span class="attr">tasks</span>:[<span class="string">&quot;concat&quot;</span>,<span class="string">&quot;jshint&quot;</span>,<span class="string">&quot;uglify&quot;</span>,<span class="string">&quot;cssmin&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过命令行安装插件（省略...）</span></span><br><span class="line">    <span class="comment">//从node_modules路径加载插件</span></span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-concat&quot;</span>);</span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-uglify&quot;</span>);</span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-cssmin&quot;</span>);</span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-jshint&quot;</span>);</span><br><span class="line">    grunt.loadNpmTasks(<span class="string">&quot;grunt-contrib-watch&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册任务：在执行$ grunt命令的时候依次执行代码的合并|检查|压缩等任务并开启监听</span></span><br><span class="line">    grunt.registerTask(<span class="string">&quot;default&quot;</span>,[<span class="string">&quot;concat&quot;</span>,<span class="string">&quot;jshint&quot;</span>,<span class="string">&quot;uglify&quot;</span>,<span class="string">&quot;cssmin&quot;</span>,<span class="string">&quot;watch&quot;</span>])</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>当在终端输入<code>$ grunt</code>命令的时候，grunt会执行以下任务</strong></p>
<p>① &nbsp;合并src/demo1.js和src/demo2.js文件并命名为index.js保存到dist目录<br>② &nbsp;按照既定的规则对Gruntfile.js和index.js文件来进行语法检查<br>③ &nbsp;压缩index.js文件并命名为index.min.js保存在dist目录<br>④ &nbsp;压缩src/index.css文件并保存到dist/index.min.css<br>⑤ &nbsp;<span style='color:#f25'>开启监听，如果src目录下面的js文件或css文件被更改则重新构建</span></p>
</blockquote>
<p>关于监听插件<code>grunt-contrib-watch</code>的更多用法建议查看<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/grunt-contrib-watch">使用文档</a></p>
<img src='../../../../z.png' width="200px">

<hr>
<ul>
<li>Posted by 博客园·<a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a> | <a target="_blank" rel="noopener" href="http://wendingding.com/">花田半亩</a></li>
<li>联系作者 简书·<a target="_blank" rel="noopener" href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a target="_blank" rel="noopener" href="http://www.cnblogs.com/wendingding/">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/05/23/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%B3%BB%E5%88%97%5B05%5D%20Yeoman%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/" class="prev">上一篇</a><a href="/2018/05/20/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%B3%BB%E5%88%97%5B03%5D%20Grunt%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%9A%84%E8%BF%90%E8%BD%AC%E6%9C%BA%E5%88%B6/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 422.4k (字)</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>